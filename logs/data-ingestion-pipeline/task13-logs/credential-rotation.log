[2025-10-01 14:10:49] [INFO] Starting Task 13: Data-Ingestion-Specific Security Procedures
[2025-10-01 14:10:49] [INFO] Component: postgresql, Dry Run: true
[2025-10-01 14:10:49] [INFO] Log file: /e/Projects/DataPipe/1-data-ingestion-pipeline/../logs/data-ingestion-pipeline/task13-logs/credential-rotation.log
[2025-10-01 14:10:49] [INFO] Validating prerequisites...
[2025-10-01 14:10:49] [SUCCESS] Prerequisites validation passed
[2025-10-01 14:10:49] [INFO] Running pre-flight checks...
[2025-10-01 14:10:50] [INFO] Memory usage check skipped (format: 617Mi)
[2025-10-01 14:10:50] [SUCCESS] Pre-flight checks passed
[2025-10-01 14:10:50] [INFO] Starting PostgreSQL CDC user credential rotation...
[2025-10-01 14:10:50] [INFO] [DRY-RUN] Would create new PostgreSQL user: debezium_20251001_141050
[2025-10-01 14:10:50] [INFO] Running end-to-end validation...
[2025-10-01 14:10:51] [INFO] Testing end-to-end data flow...
[2025-10-01 14:10:51] [INFO] Waiting 10 seconds for kafka-avro-console-consumer to start...
[2025-10-01 14:11:01] [INFO] Waiting for CDC to process INSERT...
[2025-10-01 14:11:23] [INFO] CDC test passed
[2025-10-01 14:11:23] [SUCCESS] End-to-end validation completed successfully
[2025-10-01 14:11:23] [SUCCESS] Task 13 credential rotation completed successfully!
[2025-10-01 14:11:24] [INFO] Log file saved to: /e/Projects/DataPipe/1-data-ingestion-pipeline/../logs/data-ingestion-pipeline/task13-logs/credential-rotation.log
[2025-10-01 14:11:30] [INFO] Starting Task 13: Data-Ingestion-Specific Security Procedures
[2025-10-01 14:11:30] [INFO] Component: all, Dry Run: false
[2025-10-01 14:11:30] [INFO] Log file: /e/Projects/DataPipe/1-data-ingestion-pipeline/../logs/data-ingestion-pipeline/task13-logs/credential-rotation.log
[2025-10-01 14:11:30] [INFO] Validating prerequisites...
[2025-10-01 14:11:30] [SUCCESS] Prerequisites validation passed
[2025-10-01 14:11:30] [INFO] Running pre-flight checks...
[2025-10-01 14:11:31] [INFO] Memory usage check skipped (format: 617Mi)
[2025-10-01 14:11:31] [SUCCESS] Pre-flight checks passed
[2025-10-01 14:11:31] [INFO] Creating backup of current credentials...
[2025-10-01 14:11:32] [INFO] Starting PostgreSQL CDC user credential rotation...
[2025-10-01 14:11:32] [INFO] Current CDC user: debezium
[2025-10-01 14:11:32] [INFO] Creating new CDC user: debezium_20251001_141132
[2025-10-01 14:11:32] [INFO] Pausing Debezium connector...
[2025-10-01 14:11:37] [INFO] Validating new user has proper replication permissions...
[2025-10-01 14:11:38] [INFO] New user has proper replication permissions - can use existing slot
[2025-10-01 14:11:38] [INFO] Updating Kubernetes secret with new credentials...
[2025-10-01 14:11:38] [INFO] Deleting Kafka Connect pod to force restart...
[2025-10-01 14:13:31] [INFO] Resuming Debezium connector after 20s ...
[2025-10-01 14:13:51] [INFO] Validating replication slot activity and new user connection...
[2025-10-01 14:14:02] [INFO] New user 'debezium_20251001_141132' is successfully connected for replication
[2025-10-01 14:14:02] [INFO] Validating CDC functionality...
[2025-10-01 14:14:03] [INFO] CDC is successfully processing changes after rotation
[2025-10-01 14:14:03] [INFO] Old user 'debezium' should be cleaned up after validation period
[2025-10-01 14:14:03] [INFO] To clean up old user after validation, run:
[2025-10-01 14:14:03] [INFO] kubectl --context "kind-data-ingestion" exec -n data-ingestion postgresql-0 -- psql -U postgres -d ecommerce -c "DROP USER IF EXISTS debezium;"
[2025-10-01 14:14:03] [SUCCESS] PostgreSQL CDC user rotation completed successfully
[2025-10-01 14:14:03] [INFO] Starting Kafka Connect service account credential rotation...
[2025-10-01 14:14:03] [INFO] Kafka Connect service account rotation completed (using PostgreSQL credential rotation)
[2025-10-01 14:14:03] [INFO] Starting Schema Registry credential rotation...
[2025-10-01 14:14:03] [INFO] Updating Schema Registry credentials in Kubernetes secret...
[2025-10-01 14:14:04] [INFO] Deleting Schema Registry pod to force restart...
[2025-10-01 14:15:05] [INFO] Deleting Kafka Connect pod to use new Schema Registry credentials...
[2025-10-01 14:16:19] [SUCCESS] Schema Registry credential rotation completed successfully
[2025-10-01 14:16:19] [INFO] Running end-to-end validation...
[2025-10-01 14:16:20] [INFO] Testing end-to-end data flow...
[2025-10-01 14:16:20] [INFO] Waiting 10 seconds for kafka-avro-console-consumer to start...
[2025-10-01 14:16:30] [INFO] Waiting for CDC to process INSERT...
[2025-10-01 14:16:53] [INFO] CDC test passed
[2025-10-01 14:16:53] [SUCCESS] End-to-end validation completed successfully
[2025-10-01 14:16:53] [SUCCESS] Task 13 credential rotation completed successfully!
[2025-10-01 14:16:53] [INFO] Log file saved to: /e/Projects/DataPipe/1-data-ingestion-pipeline/../logs/data-ingestion-pipeline/task13-logs/credential-rotation.log
[2025-10-01 14:16:53] [INFO] Remember to:
[2025-10-01 14:16:53] [INFO] 1. Monitor the pipeline for the next 24 hours
[2025-10-01 14:16:53] [INFO] 2. Clean up old PostgreSQL users after validation period
[2025-10-01 14:16:53] [INFO] 3. Remove credential backups after confirming stability
