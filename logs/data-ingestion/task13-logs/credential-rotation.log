[2025-10-05 14:57:39] [INFO] Starting Task 13: Data-Ingestion-Specific Security Procedures
[2025-10-05 14:57:39] [INFO] Component: postgresql, Dry Run: true, Verbose: false
[2025-10-05 14:57:39] [INFO] Log file: /e/Projects/DataPipe/1-data-ingestion-pipeline/../logs/data-ingestion/task13-logs/credential-rotation.log
[2025-10-05 14:57:39] [INFO] Validating prerequisites...
[2025-10-05 14:57:40] [SUCCESS] Prerequisites validation passed
[2025-10-05 14:57:40] [INFO] Running pre-flight checks...
[2025-10-05 14:57:40] [INFO] Memory usage check skipped (format: 624Mi)
[2025-10-05 14:57:40] [SUCCESS] Pre-flight checks passed
[2025-10-05 14:57:40] [INFO] Starting PostgreSQL CDC user credential rotation...
[2025-10-05 14:57:40] [INFO] [DRY-RUN] Would create new PostgreSQL user: debezium_20251005_145740
[2025-10-05 14:57:40] [INFO] Running end-to-end validation...
[2025-10-05 14:57:41] [INFO] Testing end-to-end data flow in 20s ...
[2025-10-05 14:58:08] [INFO] Waiting for CDC to process INSERT...
[2025-10-05 14:59:10] [INFO] CDC test passed
[2025-10-05 14:59:10] [SUCCESS] End-to-end validation completed successfully
[2025-10-05 14:59:10] [SUCCESS] Task 13 credential rotation completed successfully!
[2025-10-05 14:59:10] [INFO] Log file saved to: /e/Projects/DataPipe/1-data-ingestion-pipeline/../logs/data-ingestion/task13-logs/credential-rotation.log
[2025-10-05 14:59:17] [INFO] Starting Task 13: Data-Ingestion-Specific Security Procedures
[2025-10-05 14:59:17] [INFO] Component: all, Dry Run: false, Verbose: true
[2025-10-05 14:59:17] [INFO] Log file: /e/Projects/DataPipe/1-data-ingestion-pipeline/../logs/data-ingestion/task13-logs/credential-rotation.log
[2025-10-05 14:59:17] [INFO] Validating prerequisites...
[2025-10-05 14:59:18] [SUCCESS] Prerequisites validation passed
[2025-10-05 14:59:18] [INFO] Running pre-flight checks...
[2025-10-05 14:59:18] [INFO] Memory usage check skipped (format: 625Mi)
[2025-10-05 14:59:18] [SUCCESS] Pre-flight checks passed
[2025-10-05 14:59:19] [DEBUG] SELECT * FROM pg_replication_slots; 
          slot_name         |  plugin  | slot_type | datoid | database  | temporary | active | active_pid | xmin | catalog_xmin | restart_lsn | confirmed_flush_lsn | wal_status | safe_wal_size | two_phase 
---------------------------+----------+-----------+--------+-----------+-----------+--------+------------+------+--------------+-------------+---------------------+------------+---------------+-----------
 debezium_slot_products    | pgoutput | logical   |  16384 | ecommerce | f         | t      |        433 |      |          772 | 0/1BF6A38   | 0/229B750           | reserved   |    3902805432 | f
 debezium_slot_orders      | pgoutput | logical   |  16384 | ecommerce | f         | t      |        434 |      |          772 | 0/1BF6A38   | 0/2679A90           | reserved   |    3902805432 | f
 debezium_slot_order_items | pgoutput | logical   |  16384 | ecommerce | f         | t      |        435 |      |          780 | 0/29EFB40   | 0/29EFB40           | reserved   |    3919582648 | f
 debezium_slot_users       | pgoutput | logical   |  16384 | ecommerce | f         | t      |        757 |      |        10670 | 0/195FE928  | 0/195FE928          | reserved   |    4305458616 | f
(4 rows)
[2025-10-05 14:59:19] [DEBUG] SELECT * FROM pg_roles WHERE rolname like 'debezium%' OR rolname like 'postgres%'; 
      rolname     | rolsuper | rolinherit | rolcreaterole | rolcreatedb | rolcanlogin | rolreplication | rolconnlimit | rolpassword | rolvaliduntil | rolbypassrls |       rolconfig        |  oid  
-----------------+----------+------------+---------------+-------------+-------------+----------------+--------------+-------------+---------------+--------------+------------------------+-------
 postgres        | t        | t          | t             | t           | t           | t              |           -1 | ********    |               | t            |                        |    10
 debezium_parent | f        | t          | f             | f           | f           | t              |           -1 | ********    |               | f            |                        | 16457
 debezium        | f        | t          | f             | f           | t           | t              |           -1 | ********    |               | f            | {role=debezium_parent} | 16471
(3 rows)
[2025-10-05 14:59:19] [DEBUG] SELECT * FROM pg_stat_replication; 
  pid | usesysid | usename  |  application_name  | client_addr | client_hostname | client_port |         backend_start         | backend_xmin |   state   |  sent_lsn  | write_lsn  | flush_lsn  | replay_lsn |    write_lag    |    flush_lag    |   replay_lag    | sync_priority | sync_state |          reply_time           
-----+----------+----------+--------------------+-------------+-----------------+-------------+-------------------------------+--------------+-----------+------------+------------+------------+------------+-----------------+-----------------+-----------------+---------------+------------+-------------------------------
 757 |    16471 | debezium | Debezium Streaming | 10.244.2.8  |                 |       39604 | 2025-10-05 18:43:55.477418+00 |              | streaming | 0/195FEA48 | 0/195FEA48 | 0/195FE928 | 0/195FE928 | 00:00:07.50885  | 00:00:28.345386 | 00:00:28.345386 |             0 | async      | 1999-12-21 01:02:54.996511+00
 433 |    16471 | debezium | Debezium Streaming | 10.244.2.8  |                 |       58308 | 2025-10-05 18:41:42.531543+00 |              | streaming | 0/195FEA48 | 0/195FEA48 |            |            | 00:00:04.71011  | 00:17:29.798536 | 00:17:29.798536 |             0 | async      | 1999-12-21 01:02:54.993712+00
 434 |    16471 | debezium | Debezium Streaming | 10.244.2.8  |                 |       58322 | 2025-10-05 18:41:42.531993+00 |              | streaming | 0/195FEA48 | 0/195FEA48 |            |            | 00:00:04.665839 | 00:17:29.568953 | 00:17:29.568953 |             0 | async      | 1999-12-21 01:02:54.993668+00
 435 |    16471 | debezium | Debezium Streaming | 10.244.2.8  |                 |       58324 | 2025-10-05 18:41:42.532438+00 |              | streaming | 0/195FEA48 | 0/195FEA48 |            |            | 00:00:04.627969 | 00:17:29.42354  | 00:17:29.42354  |             0 | async      | 1999-12-21 01:02:54.99363+00
(4 rows)
[2025-10-05 14:59:19] [INFO] Creating backup of current credentials...
[2025-10-05 14:59:20] [INFO] Starting PostgreSQL CDC user credential rotation...
[2025-10-05 14:59:20] [INFO] Current CDC user: debezium
[2025-10-05 14:59:20] [INFO] Creating new CDC user: debezium_20251005_145920
[2025-10-05 14:59:21] [DEBUG] SELECT * FROM pg_replication_slots; 
          slot_name         |  plugin  | slot_type | datoid | database  | temporary | active | active_pid | xmin | catalog_xmin | restart_lsn | confirmed_flush_lsn | wal_status | safe_wal_size | two_phase 
---------------------------+----------+-----------+--------+-----------+-----------+--------+------------+------+--------------+-------------+---------------------+------------+---------------+-----------
 debezium_slot_products    | pgoutput | logical   |  16384 | ecommerce | f         | t      |        433 |      |          772 | 0/1BF6A38   | 0/229B750           | reserved   |    3902800344 | f
 debezium_slot_orders      | pgoutput | logical   |  16384 | ecommerce | f         | t      |        434 |      |          772 | 0/1BF6A38   | 0/2679A90           | reserved   |    3902800344 | f
 debezium_slot_order_items | pgoutput | logical   |  16384 | ecommerce | f         | t      |        435 |      |          780 | 0/29EFB40   | 0/29EFB40           | reserved   |    3919577560 | f
 debezium_slot_users       | pgoutput | logical   |  16384 | ecommerce | f         | t      |        757 |      |        10670 | 0/195FE928  | 0/195FE928          | reserved   |    4305453528 | f
(4 rows)
[2025-10-05 14:59:21] [DEBUG] SELECT * FROM pg_roles WHERE rolname like 'debezium%' OR rolname like 'postgres%'; 
          rolname          | rolsuper | rolinherit | rolcreaterole | rolcreatedb | rolcanlogin | rolreplication | rolconnlimit | rolpassword | rolvaliduntil | rolbypassrls |       rolconfig        |  oid  
--------------------------+----------+------------+---------------+-------------+-------------+----------------+--------------+-------------+---------------+--------------+------------------------+-------
 postgres                 | t        | t          | t             | t           | t           | t              |           -1 | ********    |               | t            |                        |    10
 debezium_parent          | f        | t          | f             | f           | f           | t              |           -1 | ********    |               | f            |                        | 16457
 debezium                 | f        | t          | f             | f           | t           | t              |           -1 | ********    |               | f            | {role=debezium_parent} | 16471
 debezium_20251005_145920 | f        | t          | f             | f           | t           | t              |           -1 | ********    |               | f            | {role=debezium_parent} | 16489
(4 rows)
[2025-10-05 14:59:21] [DEBUG] SELECT * FROM pg_stat_replication; 
  pid | usesysid | usename  |  application_name  | client_addr | client_hostname | client_port |         backend_start         | backend_xmin |   state   |  sent_lsn  | write_lsn  | flush_lsn  | replay_lsn |    write_lag    |    flush_lag    |   replay_lag    | sync_priority | sync_state |          reply_time           
-----+----------+----------+--------------------+-------------+-----------------+-------------+-------------------------------+--------------+-----------+------------+------------+------------+------------+-----------------+-----------------+-----------------+---------------+------------+-------------------------------
 757 |    16471 | debezium | Debezium Streaming | 10.244.2.8  |                 |       39604 | 2025-10-05 18:43:55.477418+00 |              | streaming | 0/195FFE28 | 0/195FEA48 | 0/195FE928 | 0/195FE928 | 00:00:07.50885  | 00:00:28.345386 | 00:00:28.345386 |             0 | async      | 1999-12-21 01:02:54.996511+00
 433 |    16471 | debezium | Debezium Streaming | 10.244.2.8  |                 |       58308 | 2025-10-05 18:41:42.531543+00 |              | streaming | 0/195FFE28 | 0/195FEA48 |            |            | 00:00:04.71011  | 00:17:29.798536 | 00:17:29.798536 |             0 | async      | 1999-12-21 01:02:54.993712+00
 434 |    16471 | debezium | Debezium Streaming | 10.244.2.8  |                 |       58322 | 2025-10-05 18:41:42.531993+00 |              | streaming | 0/195FFE28 | 0/195FEA48 |            |            | 00:00:04.665839 | 00:17:29.568953 | 00:17:29.568953 |             0 | async      | 1999-12-21 01:02:54.993668+00
 435 |    16471 | debezium | Debezium Streaming | 10.244.2.8  |                 |       58324 | 2025-10-05 18:41:42.532438+00 |              | streaming | 0/195FFE28 | 0/195FEA48 |            |            | 00:00:04.627969 | 00:17:29.42354  | 00:17:29.42354  |             0 | async      | 1999-12-21 01:02:54.99363+00
(4 rows)
[2025-10-05 14:59:21] [INFO] Pausing Debezium connectors...
[2025-10-05 14:59:27] [INFO] Validating new user has proper replication permissions...
[2025-10-05 14:59:27] [INFO] New user has proper replication permissions - can use existing slot
[2025-10-05 14:59:27] [INFO] Updating Kubernetes secret with new credentials...
[2025-10-05 14:59:27] [INFO] Deleting Kafka Connect pod to force restart...
[2025-10-05 15:00:41] [INFO] Resuming Debezium connectors after 20s ...
[2025-10-05 15:01:07] [DEBUG] SELECT * FROM pg_replication_slots; 
          slot_name         |  plugin  | slot_type | datoid | database  | temporary | active | active_pid | xmin | catalog_xmin | restart_lsn | confirmed_flush_lsn | wal_status | safe_wal_size | two_phase 
---------------------------+----------+-----------+--------+-----------+-----------+--------+------------+------+--------------+-------------+---------------------+------------+---------------+-----------
 debezium_slot_products    | pgoutput | logical   |  16384 | ecommerce | f         | t      |       3249 |      |          772 | 0/1BF6A38   | 0/229B750           | reserved   |    3902800288 | f
 debezium_slot_orders      | pgoutput | logical   |  16384 | ecommerce | f         | t      |       3251 |      |          772 | 0/1BF6A38   | 0/2679A90           | reserved   |    3902800288 | f
 debezium_slot_order_items | pgoutput | logical   |  16384 | ecommerce | f         | t      |       3250 |      |          780 | 0/29EFB40   | 0/29EFB40           | reserved   |    3919577504 | f
 debezium_slot_users       | pgoutput | logical   |  16384 | ecommerce | f         | t      |       3248 |      |        10670 | 0/195FE928  | 0/195FE928          | reserved   |    4305453472 | f
(4 rows)
[2025-10-05 15:01:07] [DEBUG] SELECT * FROM pg_roles WHERE rolname like 'debezium%' OR rolname like 'postgres%'; 
          rolname          | rolsuper | rolinherit | rolcreaterole | rolcreatedb | rolcanlogin | rolreplication | rolconnlimit | rolpassword | rolvaliduntil | rolbypassrls |       rolconfig        |  oid  
--------------------------+----------+------------+---------------+-------------+-------------+----------------+--------------+-------------+---------------+--------------+------------------------+-------
 postgres                 | t        | t          | t             | t           | t           | t              |           -1 | ********    |               | t            |                        |    10
 debezium_parent          | f        | t          | f             | f           | f           | t              |           -1 | ********    |               | f            |                        | 16457
 debezium                 | f        | t          | f             | f           | t           | t              |           -1 | ********    |               | f            | {role=debezium_parent} | 16471
 debezium_20251005_145920 | f        | t          | f             | f           | t           | t              |           -1 | ********    |               | f            | {role=debezium_parent} | 16489
(4 rows)
[2025-10-05 15:01:08] [DEBUG] SELECT * FROM pg_stat_replication; 
  pid  | usesysid |         usename          |  application_name  | client_addr | client_hostname | client_port |         backend_start         | backend_xmin |   state   |  sent_lsn  | write_lsn  | flush_lsn | replay_lsn |    write_lag    |    flush_lag    |   replay_lag    | sync_priority | sync_state |          reply_time           
------+----------+--------------------------+--------------------+-------------+-----------------+-------------+-------------------------------+--------------+-----------+------------+------------+-----------+------------+-----------------+-----------------+-----------------+---------------+------------+-------------------------------
 3248 |    16489 | debezium_20251005_145920 | Debezium Streaming | 10.244.2.9  |                 |       38184 | 2025-10-05 19:01:02.501302+00 |              | streaming | 0/195FFE60 | 0/195FE928 |           |            | 00:00:00.087539 | 00:00:00.087539 | 00:00:00.087539 |             0 | async      | 1999-12-21 01:02:55.103616+00
 3249 |    16489 | debezium_20251005_145920 | Debezium Streaming | 10.244.2.9  |                 |       38180 | 2025-10-05 19:01:02.501713+00 |              | catchup   | 0/12846398 | 0/229B750  |           |            |                 |                 |                 |             0 | async      | 1999-12-21 01:02:55.103627+00
 3250 |    16489 | debezium_20251005_145920 | Debezium Streaming | 10.244.2.9  |                 |       38182 | 2025-10-05 19:01:02.502117+00 |              | catchup   | 0/130E33F0 | 0/29EFB40  |           |            | 00:00:00.02556  | 00:00:00.02556  | 00:00:00.02556  |             0 | async      | 1999-12-21 01:02:55.103626+00
 3251 |    16489 | debezium_20251005_145920 | Debezium Streaming | 10.244.2.9  |                 |       38198 | 2025-10-05 19:01:02.502527+00 |              | catchup   | 0/11F8BD40 | 0/2679A90  |           |            |                 |                 |                 |             0 | async      | 1999-12-21 01:02:55.103615+00
(4 rows)
[2025-10-05 15:01:08] [INFO] Validating replication slot activity and new user connection...
[2025-10-05 15:01:23] [INFO] New user 'debezium_20251005_145920' is successfully connected for replication
[2025-10-05 15:01:23] [INFO] Validating CDC functionality...
[2025-10-05 15:01:24] [INFO] CDC is successfully processing changes after rotation
[2025-10-05 15:01:24] [INFO] Old user 'debezium' should be cleaned up after validation period
[2025-10-05 15:01:24] [INFO] To clean up old user after validation, run:
[2025-10-05 15:01:25] [INFO] kubectl --context "kind-data-ingestion" exec -n data-ingestion postgresql-0 -- psql -U postgres -d ecommerce -c "DROP USER IF EXISTS debezium;"
[2025-10-05 15:01:25] [SUCCESS] PostgreSQL CDC user rotation completed successfully
[2025-10-05 15:01:25] [INFO] Starting Kafka Connect service account credential rotation...
[2025-10-05 15:01:25] [INFO] Kafka Connect service account rotation completed (using PostgreSQL credential rotation)
[2025-10-05 15:01:25] [INFO] Starting Schema Registry credential rotation...
[2025-10-05 15:01:25] [DEBUG] SELECT * FROM pg_replication_slots; 
          slot_name         |  plugin  | slot_type | datoid | database  | temporary | active | active_pid | xmin | catalog_xmin | restart_lsn | confirmed_flush_lsn | wal_status | safe_wal_size | two_phase 
---------------------------+----------+-----------+--------+-----------+-----------+--------+------------+------+--------------+-------------+---------------------+------------+---------------+-----------
 debezium_slot_products    | pgoutput | logical   |  16384 | ecommerce | f         | t      |       3249 |      |          772 | 0/1BF6A38   | 0/229B750           | reserved   |    3902800288 | f
 debezium_slot_orders      | pgoutput | logical   |  16384 | ecommerce | f         | t      |       3251 |      |          772 | 0/1BF6A38   | 0/2679A90           | reserved   |    3902800288 | f
 debezium_slot_order_items | pgoutput | logical   |  16384 | ecommerce | f         | t      |       3250 |      |          780 | 0/29EFB40   | 0/29EFB40           | reserved   |    3919577504 | f
 debezium_slot_users       | pgoutput | logical   |  16384 | ecommerce | f         | t      |       3248 |      |        10670 | 0/195FE928  | 0/195FE928          | reserved   |    4305453472 | f
(4 rows)
[2025-10-05 15:01:25] [DEBUG] SELECT * FROM pg_roles WHERE rolname like 'debezium%' OR rolname like 'postgres%'; 
          rolname          | rolsuper | rolinherit | rolcreaterole | rolcreatedb | rolcanlogin | rolreplication | rolconnlimit | rolpassword | rolvaliduntil | rolbypassrls |       rolconfig        |  oid  
--------------------------+----------+------------+---------------+-------------+-------------+----------------+--------------+-------------+---------------+--------------+------------------------+-------
 postgres                 | t        | t          | t             | t           | t           | t              |           -1 | ********    |               | t            |                        |    10
 debezium_parent          | f        | t          | f             | f           | f           | t              |           -1 | ********    |               | f            |                        | 16457
 debezium                 | f        | t          | f             | f           | t           | t              |           -1 | ********    |               | f            | {role=debezium_parent} | 16471
 debezium_20251005_145920 | f        | t          | f             | f           | t           | t              |           -1 | ********    |               | f            | {role=debezium_parent} | 16489
(4 rows)
[2025-10-05 15:01:25] [DEBUG] SELECT * FROM pg_stat_replication; 
  pid  | usesysid |         usename          |  application_name  | client_addr | client_hostname | client_port |         backend_start         | backend_xmin |   state   |  sent_lsn  | write_lsn  | flush_lsn | replay_lsn |    write_lag    |    flush_lag    |   replay_lag    | sync_priority | sync_state |          reply_time           
------+----------+--------------------------+--------------------+-------------+-----------------+-------------+-------------------------------+--------------+-----------+------------+------------+-----------+------------+-----------------+-----------------+-----------------+---------------+------------+-------------------------------
 3248 |    16489 | debezium_20251005_145920 | Debezium Streaming | 10.244.2.9  |                 |       38184 | 2025-10-05 19:01:02.501302+00 |              | streaming | 0/195FFE60 | 0/195FFE60 |           |            | 00:00:10.06073  | 00:00:20.061511 | 00:00:20.061511 |             0 | async      | 1999-12-21 01:02:55.123618+00
 3249 |    16489 | debezium_20251005_145920 | Debezium Streaming | 10.244.2.9  |                 |       38180 | 2025-10-05 19:01:02.501713+00 |              | streaming | 0/195FFE60 | 0/195FFE60 |           |            | 00:00:02.825769 | 00:00:19.827281 | 00:00:19.827281 |             0 | async      | 1999-12-21 01:02:55.123627+00
 3250 |    16489 | debezium_20251005_145920 | Debezium Streaming | 10.244.2.9  |                 |       38182 | 2025-10-05 19:01:02.502117+00 |              | streaming | 0/195FFE60 | 0/195FFE60 |           |            | 00:00:02.98295  | 00:00:20.010185 | 00:00:20.010185 |             0 | async      | 1999-12-21 01:02:55.123628+00
 3251 |    16489 | debezium_20251005_145920 | Debezium Streaming | 10.244.2.9  |                 |       38198 | 2025-10-05 19:01:02.502527+00 |              | streaming | 0/195FFE60 | 0/195FFE60 |           |            | 00:00:02.772057 | 00:00:19.773613 | 00:00:19.773613 |             0 | async      | 1999-12-21 01:02:55.123573+00
(4 rows)
[2025-10-05 15:01:25] [INFO] Pausing Debezium connectors...
[2025-10-05 15:01:31] [INFO] Updating Schema Registry credentials in Kubernetes secret...
[2025-10-05 15:01:32] [INFO] Deleting Schema Registry pod to force restart...
[2025-10-05 15:02:34] [INFO] Deleting Kafka Connect pod to use new Schema Registry credentials...
[2025-10-05 15:03:48] [INFO] Resuming Debezium connectors after 20s ...
[2025-10-05 15:04:14] [DEBUG] SELECT * FROM pg_replication_slots; 
          slot_name         |  plugin  | slot_type | datoid | database  | temporary | active | active_pid | xmin | catalog_xmin | restart_lsn | confirmed_flush_lsn | wal_status | safe_wal_size | two_phase 
---------------------------+----------+-----------+--------+-----------+-----------+--------+------------+------+--------------+-------------+---------------------+------------+---------------+-----------
 debezium_slot_products    | pgoutput | logical   |  16384 | ecommerce | f         | t      |       3731 |      |          772 | 0/1BF6A38   | 0/229B750           | reserved   |    3902800056 | f
 debezium_slot_orders      | pgoutput | logical   |  16384 | ecommerce | f         | t      |       3730 |      |          772 | 0/1BF6A38   | 0/2679A90           | reserved   |    3902800056 | f
 debezium_slot_order_items | pgoutput | logical   |  16384 | ecommerce | f         | t      |       3732 |      |          780 | 0/29EFB40   | 0/29EFB40           | reserved   |    3919577272 | f
 debezium_slot_users       | pgoutput | logical   |  16384 | ecommerce | f         | t      |       3733 |      |        10670 | 0/195FE928  | 0/195FE928          | reserved   |    4305453240 | f
(4 rows)
[2025-10-05 15:04:15] [DEBUG] SELECT * FROM pg_roles WHERE rolname like 'debezium%' OR rolname like 'postgres%'; 
          rolname          | rolsuper | rolinherit | rolcreaterole | rolcreatedb | rolcanlogin | rolreplication | rolconnlimit | rolpassword | rolvaliduntil | rolbypassrls |       rolconfig        |  oid  
--------------------------+----------+------------+---------------+-------------+-------------+----------------+--------------+-------------+---------------+--------------+------------------------+-------
 postgres                 | t        | t          | t             | t           | t           | t              |           -1 | ********    |               | t            |                        |    10
 debezium_parent          | f        | t          | f             | f           | f           | t              |           -1 | ********    |               | f            |                        | 16457
 debezium                 | f        | t          | f             | f           | t           | t              |           -1 | ********    |               | f            | {role=debezium_parent} | 16471
 debezium_20251005_145920 | f        | t          | f             | f           | t           | t              |           -1 | ********    |               | f            | {role=debezium_parent} | 16489
(4 rows)
[2025-10-05 15:04:15] [DEBUG] SELECT * FROM pg_stat_replication; 
  pid  | usesysid |         usename          |  application_name  | client_addr | client_hostname | client_port |         backend_start         | backend_xmin |   state   |  sent_lsn  | write_lsn  | flush_lsn | replay_lsn |    write_lag    |    flush_lag    |   replay_lag    | sync_priority | sync_state |          reply_time           
------+----------+--------------------------+--------------------+-------------+-----------------+-------------+-------------------------------+--------------+-----------+------------+------------+-----------+------------+-----------------+-----------------+-----------------+---------------+------------+-------------------------------
 3730 |    16489 | debezium_20251005_145920 | Debezium Streaming | 10.244.2.10 |                 |       41582 | 2025-10-05 19:04:09.760283+00 |              | catchup   | 0/11577820 | 0/2679A90  |           |            |                 |                 |                 |             0 | async      | 1999-12-21 01:02:55.290907+00
 3731 |    16489 | debezium_20251005_145920 | Debezium Streaming | 10.244.2.10 |                 |       41584 | 2025-10-05 19:04:09.760923+00 |              | catchup   | 0/11C84298 | 0/229B750  |           |            |                 |                 |                 |             0 | async      | 1999-12-21 01:02:55.290897+00
 3732 |    16489 | debezium_20251005_145920 | Debezium Streaming | 10.244.2.10 |                 |       41586 | 2025-10-05 19:04:09.761319+00 |              | catchup   | 0/12E42BE8 | 0/29EFB40  |           |            | 00:00:00.015888 | 00:00:00.015888 | 00:00:00.015888 |             0 | async      | 1999-12-21 01:02:55.290892+00
 3733 |    16489 | debezium_20251005_145920 | Debezium Streaming | 10.244.2.10 |                 |       41588 | 2025-10-05 19:04:09.761837+00 |              | streaming | 0/195FFF48 | 0/195FE928 |           |            | 00:00:00.008743 | 00:00:00.008743 | 00:00:00.008743 |             0 | async      | 1999-12-21 01:02:55.290893+00
(4 rows)
[2025-10-05 15:04:15] [SUCCESS] Schema Registry credential rotation completed successfully
[2025-10-05 15:04:15] [INFO] Running end-to-end validation...
[2025-10-05 15:04:16] [INFO] Testing end-to-end data flow in 20s ...
[2025-10-05 15:04:36] [DEBUG] SELECT * FROM pg_replication_slots; 
          slot_name         |  plugin  | slot_type | datoid | database  | temporary | active | active_pid | xmin | catalog_xmin | restart_lsn | confirmed_flush_lsn | wal_status | safe_wal_size | two_phase 
---------------------------+----------+-----------+--------+-----------+-----------+--------+------------+------+--------------+-------------+---------------------+------------+---------------+-----------
 debezium_slot_products    | pgoutput | logical   |  16384 | ecommerce | f         | t      |       3731 |      |          772 | 0/1BF6A38   | 0/229B750           | reserved   |    3902795680 | f
 debezium_slot_orders      | pgoutput | logical   |  16384 | ecommerce | f         | t      |       3730 |      |          772 | 0/1BF6A38   | 0/2679A90           | reserved   |    3902795680 | f
 debezium_slot_order_items | pgoutput | logical   |  16384 | ecommerce | f         | t      |       3732 |      |          780 | 0/29EFB40   | 0/29EFB40           | reserved   |    3919572896 | f
 debezium_slot_users       | pgoutput | logical   |  16384 | ecommerce | f         | t      |       3733 |      |        10670 | 0/195FE928  | 0/195FE928          | reserved   |    4305448864 | f
(4 rows)
[2025-10-05 15:04:37] [DEBUG] SELECT * FROM pg_roles WHERE rolname like 'debezium%' OR rolname like 'postgres%'; 
          rolname          | rolsuper | rolinherit | rolcreaterole | rolcreatedb | rolcanlogin | rolreplication | rolconnlimit | rolpassword | rolvaliduntil | rolbypassrls |       rolconfig        |  oid  
--------------------------+----------+------------+---------------+-------------+-------------+----------------+--------------+-------------+---------------+--------------+------------------------+-------
 postgres                 | t        | t          | t             | t           | t           | t              |           -1 | ********    |               | t            |                        |    10
 debezium_parent          | f        | t          | f             | f           | f           | t              |           -1 | ********    |               | f            |                        | 16457
 debezium                 | f        | t          | f             | f           | t           | t              |           -1 | ********    |               | f            | {role=debezium_parent} | 16471
 debezium_20251005_145920 | f        | t          | f             | f           | t           | t              |           -1 | ********    |               | f            | {role=debezium_parent} | 16489
(4 rows)
[2025-10-05 15:04:37] [DEBUG] SELECT * FROM pg_stat_replication; 
  pid  | usesysid |         usename          |  application_name  | client_addr | client_hostname | client_port |         backend_start         | backend_xmin |   state   |  sent_lsn  | write_lsn  | flush_lsn | replay_lsn |    write_lag    |    flush_lag    |   replay_lag    | sync_priority | sync_state |          reply_time           
------+----------+--------------------------+--------------------+-------------+-----------------+-------------+-------------------------------+--------------+-----------+------------+------------+-----------+------------+-----------------+-----------------+-----------------+---------------+------------+-------------------------------
 3730 |    16489 | debezium_20251005_145920 | Debezium Streaming | 10.244.2.10 |                 |       41582 | 2025-10-05 19:04:09.760283+00 |              | streaming | 0/19601060 | 0/19601060 |           |            | 00:00:02.704086 | 00:00:19.705276 | 00:00:19.705276 |             0 | async      | 1999-12-21 01:02:55.310908+00
 3731 |    16489 | debezium_20251005_145920 | Debezium Streaming | 10.244.2.10 |                 |       41584 | 2025-10-05 19:04:09.760923+00 |              | streaming | 0/19601060 | 0/19601060 |           |            | 00:00:02.800764 | 00:00:19.801386 | 00:00:19.801386 |             0 | async      | 1999-12-21 01:02:55.310897+00
 3732 |    16489 | debezium_20251005_145920 | Debezium Streaming | 10.244.2.10 |                 |       41586 | 2025-10-05 19:04:09.761319+00 |              | streaming | 0/19601060 | 0/19601060 |           |            | 00:00:02.996018 | 00:00:20.014247 | 00:00:20.014247 |             0 | async      | 1999-12-21 01:02:55.310893+00
 3733 |    16489 | debezium_20251005_145920 | Debezium Streaming | 10.244.2.10 |                 |       41588 | 2025-10-05 19:04:09.761837+00 |              | streaming | 0/19601060 | 0/19601060 |           |            | 00:00:10.00651  | 00:00:20.006669 | 00:00:20.006669 |             0 | async      | 1999-12-21 01:02:55.310894+00
(4 rows)
[2025-10-05 15:04:37] [DEBUG] schema.registry.basic.auth.user.info=admin:Gfup8dpgw0wxsmX0A5eVRuIqN
[2025-10-05 15:04:37] [DEBUG] Waiting 6 seconds for kafka-avro-console-consumer to start...
[2025-10-05 15:04:43] [INFO] Waiting for CDC to process INSERT...
[2025-10-05 15:05:46] [INFO] CDC test passed
[2025-10-05 15:05:46] [SUCCESS] End-to-end validation completed successfully
[2025-10-05 15:05:46] [SUCCESS] Task 13 credential rotation completed successfully!
[2025-10-05 15:05:46] [INFO] Log file saved to: /e/Projects/DataPipe/1-data-ingestion-pipeline/../logs/data-ingestion/task13-logs/credential-rotation.log
[2025-10-05 15:05:46] [INFO] Remember to:
[2025-10-05 15:05:46] [INFO] 1. Monitor the pipeline for the next 24 hours
[2025-10-05 15:05:46] [INFO] 2. Clean up old PostgreSQL users after validation period
[2025-10-05 15:05:46] [INFO] 3. Remove credential backups after confirming stability
