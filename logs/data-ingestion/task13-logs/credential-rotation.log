[2025-10-07 15:35:23] [INFO] Starting Task 13: Data-Ingestion-Specific Security Procedures
[2025-10-07 15:35:23] [INFO] Component: postgresql, Dry Run: true, Verbose: false
[2025-10-07 15:35:23] [INFO] Log file: /e/Projects/DataPipe/1-data-ingestion-pipeline/../logs/data-ingestion/task13-logs/credential-rotation.log
[2025-10-07 15:35:23] [INFO] Validating prerequisites...
[2025-10-07 15:35:24] [SUCCESS] Prerequisites validation passed
[2025-10-07 15:35:24] [INFO] Running pre-flight checks...
[2025-10-07 15:35:24] [INFO] Memory usage check skipped (format: 619Mi)
[2025-10-07 15:35:24] [SUCCESS] Pre-flight checks passed
[2025-10-07 15:35:24] [INFO] Starting PostgreSQL CDC user credential rotation...
[2025-10-07 15:35:25] [INFO] [DRY-RUN] Would create new PostgreSQL user: debezium_20251007_153525
[2025-10-07 15:35:25] [INFO] Running end-to-end validation...
[2025-10-07 15:35:26] [INFO] Testing end-to-end data flow in 20s ...
[2025-10-07 15:35:52] [INFO] Waiting for CDC to process INSERT...
[2025-10-07 15:37:54] [INFO] CDC test passed
[2025-10-07 15:37:54] [SUCCESS] End-to-end validation completed successfully
[2025-10-07 15:37:54] [SUCCESS] Task 13 credential rotation completed successfully!
[2025-10-07 15:37:54] [INFO] Log file saved to: /e/Projects/DataPipe/1-data-ingestion-pipeline/../logs/data-ingestion/task13-logs/credential-rotation.log
[2025-10-07 15:38:02] [INFO] Starting Task 13: Data-Ingestion-Specific Security Procedures
[2025-10-07 15:38:02] [INFO] Component: all, Dry Run: false, Verbose: true
[2025-10-07 15:38:02] [INFO] Log file: /e/Projects/DataPipe/1-data-ingestion-pipeline/../logs/data-ingestion/task13-logs/credential-rotation.log
[2025-10-07 15:38:02] [INFO] Validating prerequisites...
[2025-10-07 15:38:03] [SUCCESS] Prerequisites validation passed
[2025-10-07 15:38:03] [INFO] Running pre-flight checks...
[2025-10-07 15:38:03] [INFO] Memory usage check skipped (format: 617Mi)
[2025-10-07 15:38:03] [SUCCESS] Pre-flight checks passed
[2025-10-07 15:38:04] [DEBUG] SELECT * FROM pg_replication_slots; 
          slot_name         |  plugin  | slot_type | datoid | database  | temporary | active | active_pid | xmin | catalog_xmin | restart_lsn | confirmed_flush_lsn | wal_status | safe_wal_size | two_phase 
---------------------------+----------+-----------+--------+-----------+-----------+--------+------------+------+--------------+-------------+---------------------+------------+---------------+-----------
 debezium_slot_products    | pgoutput | logical   |  16384 | ecommerce | f         | t      |        434 |      |       182808 | 4/76A83E38  | 4/76A83E38          | reserved   |    4263736056 | f
 debezium_slot_orders      | pgoutput | logical   |  16384 | ecommerce | f         | t      |        436 |      |       182808 | 4/76A83E38  | 4/76A83E38          | reserved   |    4263736056 | f
 debezium_slot_order_items | pgoutput | logical   |  16384 | ecommerce | f         | t      |        433 |      |       182808 | 4/76A83E38  | 4/76A83E38          | reserved   |    4263736056 | f
 debezium_slot_users       | pgoutput | logical   |  16384 | ecommerce | f         | t      |        762 |      |       183482 | 4/78DC8BE8  | 4/78DC8BE8          | reserved   |    4297290488 | f
(4 rows)
[2025-10-07 15:38:04] [DEBUG] SELECT * FROM pg_roles WHERE rolname like 'debezium%' OR rolname like 'postgres%'; 
      rolname     | rolsuper | rolinherit | rolcreaterole | rolcreatedb | rolcanlogin | rolreplication | rolconnlimit | rolpassword | rolvaliduntil | rolbypassrls |       rolconfig        |  oid  
-----------------+----------+------------+---------------+-------------+-------------+----------------+--------------+-------------+---------------+--------------+------------------------+-------
 postgres        | t        | t          | t             | t           | t           | t              |           -1 | ********    |               | t            |                        |    10
 debezium_parent | f        | t          | f             | f           | f           | t              |           -1 | ********    |               | f            |                        | 16457
 debezium        | f        | t          | f             | f           | t           | t              |           -1 | ********    |               | f            | {role=debezium_parent} | 16471
(3 rows)
[2025-10-07 15:38:04] [DEBUG] SELECT * FROM pg_stat_replication; 
  pid | usesysid | usename  |  application_name  | client_addr | client_hostname | client_port |         backend_start         | backend_xmin |   state   |  sent_lsn  | write_lsn  | flush_lsn  | replay_lsn |    write_lag    |    flush_lag    |   replay_lag    | sync_priority | sync_state |          reply_time           
-----+----------+----------+--------------------+-------------+-----------------+-------------+-------------------------------+--------------+-----------+------------+------------+------------+------------+-----------------+-----------------+-----------------+---------------+------------+-------------------------------
 762 |    16471 | debezium | Debezium Streaming | 10.244.2.9  |                 |       35638 | 2025-10-07 19:22:39.643643+00 |              | streaming | 4/78DC8D08 | 4/78DC8D08 | 4/78DC8BE8 | 4/78DC8BE8 | 00:00:06.946354 | 00:00:28.874405 | 00:00:28.874405 |             0 | async      | 1999-12-21 01:02:10.860205+00
 433 |    16471 | debezium | Debezium Streaming | 10.244.2.9  |                 |       48594 | 2025-10-07 19:20:25.676635+00 |              | streaming | 4/78DC8D08 | 4/78DC8D08 |            |            | 00:00:05.959886 | 00:17:29.287096 | 00:17:29.287096 |             0 | async      | 1999-12-21 01:02:10.859219+00
 434 |    16471 | debezium | Debezium Streaming | 10.244.2.9  |                 |       48592 | 2025-10-07 19:20:25.677048+00 |              | streaming | 4/78DC8D08 | 4/78DC8D08 |            |            | 00:00:03.082493 | 00:17:30.006464 | 00:17:30.006464 |             0 | async      | 1999-12-21 01:02:10.856341+00
 436 |    16471 | debezium | Debezium Streaming | 10.244.2.9  |                 |       48628 | 2025-10-07 19:20:25.677975+00 |              | streaming | 4/78DC8D08 | 4/78DC8D08 |            |            | 00:00:05.959352 | 00:17:29.286949 | 00:17:29.286949 |             0 | async      | 1999-12-21 01:02:10.859219+00
(4 rows)
[2025-10-07 15:38:04] [INFO] Creating backup of current credentials...
[2025-10-07 15:38:05] [INFO] Starting PostgreSQL CDC user credential rotation...
[2025-10-07 15:38:05] [INFO] Current CDC user: debezium
[2025-10-07 15:38:05] [INFO] Creating new CDC user: debezium_20251007_153805
[2025-10-07 15:38:06] [DEBUG] SELECT * FROM pg_replication_slots; 
          slot_name         |  plugin  | slot_type | datoid | database  | temporary | active | active_pid | xmin | catalog_xmin | restart_lsn | confirmed_flush_lsn | wal_status | safe_wal_size | two_phase 
---------------------------+----------+-----------+--------+-----------+-----------+--------+------------+------+--------------+-------------+---------------------+------------+---------------+-----------
 debezium_slot_products    | pgoutput | logical   |  16384 | ecommerce | f         | t      |        434 |      |       182808 | 4/76A83E38  | 4/76A83E38          | reserved   |    4263730944 | f
 debezium_slot_orders      | pgoutput | logical   |  16384 | ecommerce | f         | t      |        436 |      |       182808 | 4/76A83E38  | 4/76A83E38          | reserved   |    4263730944 | f
 debezium_slot_order_items | pgoutput | logical   |  16384 | ecommerce | f         | t      |        433 |      |       182808 | 4/76A83E38  | 4/76A83E38          | reserved   |    4263730944 | f
 debezium_slot_users       | pgoutput | logical   |  16384 | ecommerce | f         | t      |        762 |      |       183482 | 4/78DC8BE8  | 4/78DC8BE8          | reserved   |    4297285376 | f
(4 rows)
[2025-10-07 15:38:06] [DEBUG] SELECT * FROM pg_roles WHERE rolname like 'debezium%' OR rolname like 'postgres%'; 
          rolname          | rolsuper | rolinherit | rolcreaterole | rolcreatedb | rolcanlogin | rolreplication | rolconnlimit | rolpassword | rolvaliduntil | rolbypassrls |       rolconfig        |  oid  
--------------------------+----------+------------+---------------+-------------+-------------+----------------+--------------+-------------+---------------+--------------+------------------------+-------
 postgres                 | t        | t          | t             | t           | t           | t              |           -1 | ********    |               | t            |                        |    10
 debezium_parent          | f        | t          | f             | f           | f           | t              |           -1 | ********    |               | f            |                        | 16457
 debezium                 | f        | t          | f             | f           | t           | t              |           -1 | ********    |               | f            | {role=debezium_parent} | 16471
 debezium_20251007_153805 | f        | t          | f             | f           | t           | t              |           -1 | ********    |               | f            | {role=debezium_parent} | 16514
(4 rows)
[2025-10-07 15:38:06] [DEBUG] SELECT * FROM pg_stat_replication; 
  pid | usesysid | usename  |  application_name  | client_addr | client_hostname | client_port |         backend_start         | backend_xmin |   state   |  sent_lsn  | write_lsn  | flush_lsn  | replay_lsn |    write_lag    |    flush_lag    |   replay_lag    | sync_priority | sync_state |          reply_time           
-----+----------+----------+--------------------+-------------+-----------------+-------------+-------------------------------+--------------+-----------+------------+------------+------------+------------+-----------------+-----------------+-----------------+---------------+------------+-------------------------------
 762 |    16471 | debezium | Debezium Streaming | 10.244.2.9  |                 |       35638 | 2025-10-07 19:22:39.643643+00 |              | streaming | 4/78DCA100 | 4/78DC8D08 | 4/78DC8BE8 | 4/78DC8BE8 | 00:00:06.946354 | 00:00:28.874405 | 00:00:28.874405 |             0 | async      | 1999-12-21 01:02:10.860205+00
 433 |    16471 | debezium | Debezium Streaming | 10.244.2.9  |                 |       48594 | 2025-10-07 19:20:25.676635+00 |              | streaming | 4/78DCA100 | 4/78DC8D08 |            |            | 00:00:05.959886 | 00:17:29.287096 | 00:17:29.287096 |             0 | async      | 1999-12-21 01:02:10.859219+00
 434 |    16471 | debezium | Debezium Streaming | 10.244.2.9  |                 |       48592 | 2025-10-07 19:20:25.677048+00 |              | streaming | 4/78DCA100 | 4/78DC8D08 |            |            | 00:00:03.082493 | 00:17:40.005979 | 00:17:40.005979 |             0 | async      | 1999-12-21 01:02:10.866343+00
 436 |    16471 | debezium | Debezium Streaming | 10.244.2.9  |                 |       48628 | 2025-10-07 19:20:25.677975+00 |              | streaming | 4/78DCA100 | 4/78DC8D08 |            |            | 00:00:05.959352 | 00:17:29.286949 | 00:17:29.286949 |             0 | async      | 1999-12-21 01:02:10.859219+00
(4 rows)
[2025-10-07 15:38:06] [INFO] Pausing Debezium connectors...
[2025-10-07 15:38:12] [INFO] Validating new user has proper replication permissions...
[2025-10-07 15:38:12] [INFO] New user has proper replication permissions - can use existing slot
[2025-10-07 15:38:12] [INFO] Updating Kubernetes secret with new credentials...
[2025-10-07 15:38:13] [INFO] Deleting Kafka Connect pod to force restart...
[2025-10-07 15:39:26] [INFO] Resuming Debezium connectors after 20s ...
[2025-10-07 15:39:52] [DEBUG] SELECT * FROM pg_replication_slots; 
          slot_name         |  plugin  | slot_type | datoid | database  | temporary | active | active_pid | xmin | catalog_xmin | restart_lsn | confirmed_flush_lsn | wal_status | safe_wal_size | two_phase 
---------------------------+----------+-----------+--------+-----------+-----------+--------+------------+------+--------------+-------------+---------------------+------------+---------------+-----------
 debezium_slot_products    | pgoutput | logical   |  16384 | ecommerce | f         | t      |       3263 |      |       182808 | 4/76A83E38  | 4/76A83E38          | reserved   |    4263730944 | f
 debezium_slot_orders      | pgoutput | logical   |  16384 | ecommerce | f         | t      |       3262 |      |       182808 | 4/76A83E38  | 4/76A83E38          | reserved   |    4263730944 | f
 debezium_slot_order_items | pgoutput | logical   |  16384 | ecommerce | f         | t      |       3267 |      |       182808 | 4/76A83E38  | 4/76A83E38          | reserved   |    4263730944 | f
 debezium_slot_users       | pgoutput | logical   |  16384 | ecommerce | f         | t      |       3261 |      |       183482 | 4/78DC8BE8  | 4/78DC8BE8          | reserved   |    4297285376 | f
(4 rows)
[2025-10-07 15:39:52] [DEBUG] SELECT * FROM pg_roles WHERE rolname like 'debezium%' OR rolname like 'postgres%'; 
          rolname          | rolsuper | rolinherit | rolcreaterole | rolcreatedb | rolcanlogin | rolreplication | rolconnlimit | rolpassword | rolvaliduntil | rolbypassrls |       rolconfig        |  oid  
--------------------------+----------+------------+---------------+-------------+-------------+----------------+--------------+-------------+---------------+--------------+------------------------+-------
 postgres                 | t        | t          | t             | t           | t           | t              |           -1 | ********    |               | t            |                        |    10
 debezium_parent          | f        | t          | f             | f           | f           | t              |           -1 | ********    |               | f            |                        | 16457
 debezium                 | f        | t          | f             | f           | t           | t              |           -1 | ********    |               | f            | {role=debezium_parent} | 16471
 debezium_20251007_153805 | f        | t          | f             | f           | t           | t              |           -1 | ********    |               | f            | {role=debezium_parent} | 16514
(4 rows)
[2025-10-07 15:39:53] [DEBUG] SELECT * FROM pg_stat_replication; 
  pid  | usesysid |         usename          |  application_name  | client_addr | client_hostname | client_port |         backend_start         | backend_xmin |   state   |  sent_lsn  | write_lsn  | flush_lsn | replay_lsn |    write_lag    |    flush_lag    |   replay_lag    | sync_priority | sync_state |          reply_time           
------+----------+--------------------------+--------------------+-------------+-----------------+-------------+-------------------------------+--------------+-----------+------------+------------+-----------+------------+-----------------+-----------------+-----------------+---------------+------------+-------------------------------
 3261 |    16514 | debezium_20251007_153805 | Debezium Streaming | 10.244.2.10 |                 |       38558 | 2025-10-07 19:39:47.496264+00 |              | streaming | 4/78DCA100 | 4/78DC8BE8 |           |            | 00:00:00.039008 | 00:00:00.039008 | 00:00:00.039008 |             0 | async      | 1999-12-21 01:02:10.968176+00
 3262 |    16514 | debezium_20251007_153805 | Debezium Streaming | 10.244.2.10 |                 |       38564 | 2025-10-07 19:39:47.53049+00  |              | streaming | 4/78DCA100 | 4/76A83E38 |           |            | 00:00:00.007698 | 00:00:00.007698 | 00:00:00.007698 |             0 | async      | 1999-12-21 01:02:10.968188+00
 3263 |    16514 | debezium_20251007_153805 | Debezium Streaming | 10.244.2.10 |                 |       38560 | 2025-10-07 19:39:47.530869+00 |              | streaming | 4/78DCA100 | 4/76A83E38 |           |            | 00:00:00.006507 | 00:00:00.006507 | 00:00:00.006507 |             0 | async      | 1999-12-21 01:02:10.968187+00
 3267 |    16514 | debezium_20251007_153805 | Debezium Streaming | 10.244.2.10 |                 |       38604 | 2025-10-07 19:39:47.584108+00 |              | streaming | 4/78DCA100 | 4/76A83E38 |           |            | 00:00:00.019957 | 00:00:00.019957 | 00:00:00.019957 |             0 | async      | 1999-12-21 01:02:10.968203+00
(4 rows)
[2025-10-07 15:39:53] [INFO] Validating replication slot activity and new user connection...
[2025-10-07 15:40:08] [INFO] New user 'debezium_20251007_153805' is successfully connected for replication
[2025-10-07 15:40:08] [INFO] Validating CDC functionality...
[2025-10-07 15:40:10] [INFO] CDC is successfully processing changes after rotation
[2025-10-07 15:40:10] [INFO] Old user 'debezium' should be cleaned up after validation period
[2025-10-07 15:40:10] [INFO] To clean up old user after validation, run:
[2025-10-07 15:40:10] [INFO] kubectl --context "kind-data-ingestion" exec -n data-ingestion postgresql-0 -- psql -U postgres -d ecommerce -c "DROP USER IF EXISTS debezium;"
[2025-10-07 15:40:10] [SUCCESS] PostgreSQL CDC user rotation completed successfully
[2025-10-07 15:40:10] [INFO] Starting Kafka Connect service account credential rotation...
[2025-10-07 15:40:10] [INFO] Kafka Connect service account rotation completed (using PostgreSQL credential rotation)
[2025-10-07 15:40:10] [INFO] Starting Schema Registry credential rotation...
[2025-10-07 15:40:10] [DEBUG] SELECT * FROM pg_replication_slots; 
          slot_name         |  plugin  | slot_type | datoid | database  | temporary | active | active_pid | xmin | catalog_xmin | restart_lsn | confirmed_flush_lsn | wal_status | safe_wal_size | two_phase 
---------------------------+----------+-----------+--------+-----------+-----------+--------+------------+------+--------------+-------------+---------------------+------------+---------------+-----------
 debezium_slot_products    | pgoutput | logical   |  16384 | ecommerce | f         | t      |       3263 |      |       182808 | 4/76A83E38  | 4/76A83E38          | reserved   |    4263730944 | f
 debezium_slot_orders      | pgoutput | logical   |  16384 | ecommerce | f         | t      |       3262 |      |       182808 | 4/76A83E38  | 4/76A83E38          | reserved   |    4263730944 | f
 debezium_slot_order_items | pgoutput | logical   |  16384 | ecommerce | f         | t      |       3267 |      |       182808 | 4/76A83E38  | 4/76A83E38          | reserved   |    4263730944 | f
 debezium_slot_users       | pgoutput | logical   |  16384 | ecommerce | f         | t      |       3261 |      |       183482 | 4/78DC8BE8  | 4/78DC8BE8          | reserved   |    4297285376 | f
(4 rows)
[2025-10-07 15:40:10] [DEBUG] SELECT * FROM pg_roles WHERE rolname like 'debezium%' OR rolname like 'postgres%'; 
          rolname          | rolsuper | rolinherit | rolcreaterole | rolcreatedb | rolcanlogin | rolreplication | rolconnlimit | rolpassword | rolvaliduntil | rolbypassrls |       rolconfig        |  oid  
--------------------------+----------+------------+---------------+-------------+-------------+----------------+--------------+-------------+---------------+--------------+------------------------+-------
 postgres                 | t        | t          | t             | t           | t           | t              |           -1 | ********    |               | t            |                        |    10
 debezium_parent          | f        | t          | f             | f           | f           | t              |           -1 | ********    |               | f            |                        | 16457
 debezium                 | f        | t          | f             | f           | t           | t              |           -1 | ********    |               | f            | {role=debezium_parent} | 16471
 debezium_20251007_153805 | f        | t          | f             | f           | t           | t              |           -1 | ********    |               | f            | {role=debezium_parent} | 16514
(4 rows)
[2025-10-07 15:40:11] [DEBUG] SELECT * FROM pg_stat_replication; 
  pid  | usesysid |         usename          |  application_name  | client_addr | client_hostname | client_port |         backend_start         | backend_xmin |   state   |  sent_lsn  | write_lsn  | flush_lsn | replay_lsn |    write_lag    |    flush_lag    |   replay_lag    | sync_priority | sync_state |          reply_time           
------+----------+--------------------------+--------------------+-------------+-----------------+-------------+-------------------------------+--------------+-----------+------------+------------+-----------+------------+-----------------+-----------------+-----------------+---------------+------------+-------------------------------
 3261 |    16514 | debezium_20251007_153805 | Debezium Streaming | 10.244.2.10 |                 |       38558 | 2025-10-07 19:39:47.496264+00 |              | streaming | 4/78DCA100 | 4/78DCA100 |           |            | 00:00:10.038212 | 00:00:20.038181 | 00:00:20.038181 |             0 | async      | 1999-12-21 01:02:10.988177+00
 3262 |    16514 | debezium_20251007_153805 | Debezium Streaming | 10.244.2.10 |                 |       38564 | 2025-10-07 19:39:47.53049+00  |              | streaming | 4/78DCA100 | 4/78DCA100 |           |            | 00:00:10.006853 | 00:00:20.00679  | 00:00:20.00679  |             0 | async      | 1999-12-21 01:02:10.988189+00
 3263 |    16514 | debezium_20251007_153805 | Debezium Streaming | 10.244.2.10 |                 |       38560 | 2025-10-07 19:39:47.530869+00 |              | streaming | 4/78DCA100 | 4/78DCA100 |           |            | 00:00:10.005697 | 00:00:20.005621 | 00:00:20.005621 |             0 | async      | 1999-12-21 01:02:10.988188+00
 3267 |    16514 | debezium_20251007_153805 | Debezium Streaming | 10.244.2.10 |                 |       38604 | 2025-10-07 19:39:47.584108+00 |              | streaming | 4/78DCA100 | 4/78DCA100 |           |            | 00:00:09.991618 | 00:00:19.991548 | 00:00:19.991548 |             0 | async      | 1999-12-21 01:02:10.988204+00
(4 rows)
[2025-10-07 15:40:11] [INFO] Pausing Debezium connectors...
[2025-10-07 15:40:17] [INFO] Updating Schema Registry credentials in Kubernetes secret...
[2025-10-07 15:40:17] [INFO] Deleting Schema Registry pod to force restart...
[2025-10-07 15:41:19] [INFO] Deleting Kafka Connect pod to use new Schema Registry credentials...
[2025-10-07 15:42:32] [INFO] Resuming Debezium connectors after 20s ...
[2025-10-07 15:42:58] [DEBUG] SELECT * FROM pg_replication_slots; 
          slot_name         |  plugin  | slot_type | datoid | database  | temporary | active | active_pid | xmin | catalog_xmin | restart_lsn | confirmed_flush_lsn | wal_status | safe_wal_size | two_phase 
---------------------------+----------+-----------+--------+-----------+-----------+--------+------------+------+--------------+-------------+---------------------+------------+---------------+-----------
 debezium_slot_products    | pgoutput | logical   |  16384 | ecommerce | f         | t      |       3745 |      |       182808 | 4/76A83E38  | 4/76A83E38          | reserved   |    4263730712 | f
 debezium_slot_orders      | pgoutput | logical   |  16384 | ecommerce | f         | t      |       3742 |      |       182808 | 4/76A83E38  | 4/76A83E38          | reserved   |    4263730712 | f
 debezium_slot_order_items | pgoutput | logical   |  16384 | ecommerce | f         | t      |       3744 |      |       182808 | 4/76A83E38  | 4/76A83E38          | reserved   |    4263730712 | f
 debezium_slot_users       | pgoutput | logical   |  16384 | ecommerce | f         | t      |       3743 |      |       183482 | 4/78DC8BE8  | 4/78DC8BE8          | reserved   |    4297285144 | f
(4 rows)
[2025-10-07 15:42:59] [DEBUG] SELECT * FROM pg_roles WHERE rolname like 'debezium%' OR rolname like 'postgres%'; 
          rolname          | rolsuper | rolinherit | rolcreaterole | rolcreatedb | rolcanlogin | rolreplication | rolconnlimit | rolpassword | rolvaliduntil | rolbypassrls |       rolconfig        |  oid  
--------------------------+----------+------------+---------------+-------------+-------------+----------------+--------------+-------------+---------------+--------------+------------------------+-------
 postgres                 | t        | t          | t             | t           | t           | t              |           -1 | ********    |               | t            |                        |    10
 debezium_parent          | f        | t          | f             | f           | f           | t              |           -1 | ********    |               | f            |                        | 16457
 debezium                 | f        | t          | f             | f           | t           | t              |           -1 | ********    |               | f            | {role=debezium_parent} | 16471
 debezium_20251007_153805 | f        | t          | f             | f           | t           | t              |           -1 | ********    |               | f            | {role=debezium_parent} | 16514
(4 rows)
[2025-10-07 15:42:59] [DEBUG] SELECT * FROM pg_stat_replication; 
  pid  | usesysid |         usename          |  application_name  | client_addr | client_hostname | client_port |         backend_start         | backend_xmin |   state   |  sent_lsn  | write_lsn  | flush_lsn | replay_lsn |    write_lag    |    flush_lag    |   replay_lag    | sync_priority | sync_state |          reply_time           
------+----------+--------------------------+--------------------+-------------+-----------------+-------------+-------------------------------+--------------+-----------+------------+------------+-----------+------------+-----------------+-----------------+-----------------+---------------+------------+-------------------------------
 3742 |    16514 | debezium_20251007_153805 | Debezium Streaming | 10.244.2.11 |                 |       44136 | 2025-10-07 19:42:54.045844+00 |              | streaming | 4/78DCA1E8 | 4/76A83E38 |           |            | 00:00:00.006186 | 00:00:00.006186 | 00:00:00.006186 |             0 | async      | 1999-12-21 01:02:11.154706+00
 3743 |    16514 | debezium_20251007_153805 | Debezium Streaming | 10.244.2.11 |                 |       44138 | 2025-10-07 19:42:54.046354+00 |              | streaming | 4/78DCA1E8 | 4/78DC8BE8 |           |            | 00:00:00.032844 | 00:00:00.032844 | 00:00:00.032844 |             0 | async      | 1999-12-21 01:02:11.15471+00
 3744 |    16514 | debezium_20251007_153805 | Debezium Streaming | 10.244.2.11 |                 |       44140 | 2025-10-07 19:42:54.046782+00 |              | streaming | 4/78DCA1E8 | 4/76A83E38 |           |            | 00:00:00.008412 | 00:00:00.008412 | 00:00:00.008412 |             0 | async      | 1999-12-21 01:02:11.154708+00
 3745 |    16514 | debezium_20251007_153805 | Debezium Streaming | 10.244.2.11 |                 |       44142 | 2025-10-07 19:42:54.047262+00 |              | streaming | 4/78DCA1E8 | 4/76A83E38 |           |            | 00:00:00.018583 | 00:00:00.018583 | 00:00:00.018583 |             0 | async      | 1999-12-21 01:02:11.154709+00
(4 rows)
[2025-10-07 15:42:59] [SUCCESS] Schema Registry credential rotation completed successfully
[2025-10-07 15:42:59] [INFO] Running end-to-end validation...
[2025-10-07 15:43:00] [INFO] Testing end-to-end data flow in 20s ...
[2025-10-07 15:43:20] [DEBUG] SELECT * FROM pg_replication_slots; 
          slot_name         |  plugin  | slot_type | datoid | database  | temporary | active | active_pid | xmin | catalog_xmin | restart_lsn | confirmed_flush_lsn | wal_status | safe_wal_size | two_phase 
---------------------------+----------+-----------+--------+-----------+-----------+--------+------------+------+--------------+-------------+---------------------+------------+---------------+-----------
 debezium_slot_products    | pgoutput | logical   |  16384 | ecommerce | f         | t      |       3745 |      |       182808 | 4/76A83E38  | 4/76A83E38          | reserved   |    4263722400 | f
 debezium_slot_orders      | pgoutput | logical   |  16384 | ecommerce | f         | t      |       3742 |      |       182808 | 4/76A83E38  | 4/76A83E38          | reserved   |    4263722400 | f
 debezium_slot_order_items | pgoutput | logical   |  16384 | ecommerce | f         | t      |       3744 |      |       182808 | 4/76A83E38  | 4/76A83E38          | reserved   |    4263722400 | f
 debezium_slot_users       | pgoutput | logical   |  16384 | ecommerce | f         | t      |       3743 |      |       183482 | 4/78DC8BE8  | 4/78DC8BE8          | reserved   |    4297276832 | f
(4 rows)
[2025-10-07 15:43:21] [DEBUG] SELECT * FROM pg_roles WHERE rolname like 'debezium%' OR rolname like 'postgres%'; 
          rolname          | rolsuper | rolinherit | rolcreaterole | rolcreatedb | rolcanlogin | rolreplication | rolconnlimit | rolpassword | rolvaliduntil | rolbypassrls |       rolconfig        |  oid  
--------------------------+----------+------------+---------------+-------------+-------------+----------------+--------------+-------------+---------------+--------------+------------------------+-------
 postgres                 | t        | t          | t             | t           | t           | t              |           -1 | ********    |               | t            |                        |    10
 debezium_parent          | f        | t          | f             | f           | f           | t              |           -1 | ********    |               | f            |                        | 16457
 debezium                 | f        | t          | f             | f           | t           | t              |           -1 | ********    |               | f            | {role=debezium_parent} | 16471
 debezium_20251007_153805 | f        | t          | f             | f           | t           | t              |           -1 | ********    |               | f            | {role=debezium_parent} | 16514
(4 rows)
[2025-10-07 15:43:21] [DEBUG] SELECT * FROM pg_stat_replication; 
  pid  | usesysid |         usename          |  application_name  | client_addr | client_hostname | client_port |         backend_start         | backend_xmin |   state   |  sent_lsn  | write_lsn  | flush_lsn | replay_lsn |    write_lag    |    flush_lag    |   replay_lag    | sync_priority | sync_state |          reply_time           
------+----------+--------------------------+--------------------+-------------+-----------------+-------------+-------------------------------+--------------+-----------+------------+------------+-----------+------------+-----------------+-----------------+-----------------+---------------+------------+-------------------------------
 3742 |    16514 | debezium_20251007_153805 | Debezium Streaming | 10.244.2.11 |                 |       44136 | 2025-10-07 19:42:54.045844+00 |              | streaming | 4/78DCC260 | 4/78DCC260 |           |            | 00:00:10.005231 | 00:00:20.00543  | 00:00:20.00543  |             0 | async      | 1999-12-21 01:02:11.174707+00
 3743 |    16514 | debezium_20251007_153805 | Debezium Streaming | 10.244.2.11 |                 |       44138 | 2025-10-07 19:42:54.046354+00 |              | streaming | 4/78DCC260 | 4/78DCC260 |           |            | 00:00:10.00848  | 00:00:20.0086   | 00:00:20.0086   |             0 | async      | 1999-12-21 01:02:11.174709+00
 3744 |    16514 | debezium_20251007_153805 | Debezium Streaming | 10.244.2.11 |                 |       44140 | 2025-10-07 19:42:54.046782+00 |              | streaming | 4/78DCC260 | 4/78DCC260 |           |            | 00:00:10.006367 | 00:00:20.006497 | 00:00:20.006497 |             0 | async      | 1999-12-21 01:02:11.174709+00
 3745 |    16514 | debezium_20251007_153805 | Debezium Streaming | 10.244.2.11 |                 |       44142 | 2025-10-07 19:42:54.047262+00 |              | streaming | 4/78DCC260 | 4/78DCC260 |           |            | 00:00:10.00609  | 00:00:20.006241 | 00:00:20.006241 |             0 | async      | 1999-12-21 01:02:11.174708+00
(4 rows)
[2025-10-07 15:43:21] [DEBUG] schema.registry.basic.auth.user.info=admin:Neb5N692ljzIRIBZtLBKCqNZY
[2025-10-07 15:43:21] [DEBUG] Waiting 6 seconds for kafka-avro-console-consumer to start...
[2025-10-07 15:43:27] [INFO] Waiting for CDC to process INSERT...
[2025-10-07 15:45:30] [INFO] CDC test passed
[2025-10-07 15:45:30] [SUCCESS] End-to-end validation completed successfully
[2025-10-07 15:45:30] [SUCCESS] Task 13 credential rotation completed successfully!
[2025-10-07 15:45:30] [INFO] Log file saved to: /e/Projects/DataPipe/1-data-ingestion-pipeline/../logs/data-ingestion/task13-logs/credential-rotation.log
[2025-10-07 15:45:30] [INFO] Remember to:
[2025-10-07 15:45:30] [INFO] 1. Monitor the pipeline for the next 24 hours
[2025-10-07 15:45:30] [INFO] 2. Clean up old PostgreSQL users after validation period
[2025-10-07 15:45:30] [INFO] 3. Remove credential backups after confirming stability
