[2025-10-05 17:39:42] [INFO] Starting Task 13: Data-Ingestion-Specific Security Procedures
[2025-10-05 17:39:42] [INFO] Component: postgresql, Dry Run: true, Verbose: false
[2025-10-05 17:39:42] [INFO] Log file: /e/Projects/DataPipe/1-data-ingestion-pipeline/../logs/data-ingestion/task13-logs/credential-rotation.log
[2025-10-05 17:39:42] [INFO] Validating prerequisites...
[2025-10-05 17:39:42] [SUCCESS] Prerequisites validation passed
[2025-10-05 17:39:43] [INFO] Running pre-flight checks...
[2025-10-05 17:39:43] [INFO] Memory usage check skipped (format: 614Mi)
[2025-10-05 17:39:43] [SUCCESS] Pre-flight checks passed
[2025-10-05 17:39:43] [INFO] Starting PostgreSQL CDC user credential rotation...
[2025-10-05 17:39:43] [INFO] [DRY-RUN] Would create new PostgreSQL user: debezium_20251005_173943
[2025-10-05 17:39:43] [INFO] Running end-to-end validation...
[2025-10-05 17:39:44] [INFO] Testing end-to-end data flow in 20s ...
[2025-10-05 17:40:11] [INFO] Waiting for CDC to process INSERT...
[2025-10-05 17:42:12] [INFO] CDC test passed
[2025-10-05 17:42:12] [SUCCESS] End-to-end validation completed successfully
[2025-10-05 17:42:12] [SUCCESS] Task 13 credential rotation completed successfully!
[2025-10-05 17:42:12] [INFO] Log file saved to: /e/Projects/DataPipe/1-data-ingestion-pipeline/../logs/data-ingestion/task13-logs/credential-rotation.log
[2025-10-05 17:42:20] [INFO] Starting Task 13: Data-Ingestion-Specific Security Procedures
[2025-10-05 17:42:20] [INFO] Component: all, Dry Run: false, Verbose: true
[2025-10-05 17:42:20] [INFO] Log file: /e/Projects/DataPipe/1-data-ingestion-pipeline/../logs/data-ingestion/task13-logs/credential-rotation.log
[2025-10-05 17:42:20] [INFO] Validating prerequisites...
[2025-10-05 17:42:21] [SUCCESS] Prerequisites validation passed
[2025-10-05 17:42:21] [INFO] Running pre-flight checks...
[2025-10-05 17:42:21] [INFO] Memory usage check skipped (format: 615Mi)
[2025-10-05 17:42:21] [SUCCESS] Pre-flight checks passed
[2025-10-05 17:42:22] [DEBUG] SELECT * FROM pg_replication_slots; 
          slot_name         |  plugin  | slot_type | datoid | database  | temporary | active | active_pid | xmin | catalog_xmin | restart_lsn | confirmed_flush_lsn | wal_status | safe_wal_size | two_phase 
---------------------------+----------+-----------+--------+-----------+-----------+--------+------------+------+--------------+-------------+---------------------+------------+---------------+-----------
 debezium_slot_products    | pgoutput | logical   |  16384 | ecommerce | f         | t      |        433 |      |        15919 | 0/55A27648  | 0/55A27648          | reserved   |    4285971848 | f
 debezium_slot_orders      | pgoutput | logical   |  16384 | ecommerce | f         | t      |        430 |      |        15919 | 0/55A27648  | 0/55A27648          | reserved   |    4285971848 | f
 debezium_slot_order_items | pgoutput | logical   |  16384 | ecommerce | f         | t      |        432 |      |        15919 | 0/55A27648  | 0/55A27648          | reserved   |    4285971848 | f
 debezium_slot_users       | pgoutput | logical   |  16384 | ecommerce | f         | t      |        757 |      |        16594 | 0/56894158  | 0/56894158          | reserved   |    4302749064 | f
(4 rows)
[2025-10-05 17:42:22] [DEBUG] SELECT * FROM pg_roles WHERE rolname like 'debezium%' OR rolname like 'postgres%'; 
      rolname     | rolsuper | rolinherit | rolcreaterole | rolcreatedb | rolcanlogin | rolreplication | rolconnlimit | rolpassword | rolvaliduntil | rolbypassrls |       rolconfig        |  oid  
-----------------+----------+------------+---------------+-------------+-------------+----------------+--------------+-------------+---------------+--------------+------------------------+-------
 postgres        | t        | t          | t             | t           | t           | t              |           -1 | ********    |               | t            |                        |    10
 debezium_parent | f        | t          | f             | f           | f           | t              |           -1 | ********    |               | f            |                        | 16457
 debezium        | f        | t          | f             | f           | t           | t              |           -1 | ********    |               | f            | {role=debezium_parent} | 16471
(3 rows)
[2025-10-05 17:42:22] [DEBUG] SELECT * FROM pg_stat_replication; 
  pid | usesysid | usename  |  application_name  | client_addr | client_hostname | client_port |         backend_start         | backend_xmin |   state   |  sent_lsn  | write_lsn  | flush_lsn  | replay_lsn |    write_lag    |    flush_lag    |   replay_lag    | sync_priority | sync_state |          reply_time           
-----+----------+----------+--------------------+-------------+-----------------+-------------+-------------------------------+--------------+-----------+------------+------------+------------+------------+-----------------+-----------------+-----------------+---------------+------------+-------------------------------
 757 |    16471 | debezium | Debezium Streaming | 10.244.2.9  |                 |       53482 | 2025-10-05 21:26:58.533343+00 |              | streaming | 0/56894278 | 0/56894278 | 0/56894158 | 0/56894158 | 00:00:07.549937 | 00:00:27.636706 | 00:00:27.636706 |             0 | async      | 1999-12-21 01:03:04.780007+00
 430 |    16471 | debezium | Debezium Streaming | 10.244.2.9  |                 |       55534 | 2025-10-05 21:24:45.545888+00 |              | streaming | 0/56894278 | 0/56894278 |            |            | 00:00:05.544385 | 00:17:25.973049 | 00:17:25.973049 |             0 | async      | 1999-12-21 01:03:04.778002+00
 432 |    16471 | debezium | Debezium Streaming | 10.244.2.9  |                 |       55530 | 2025-10-05 21:24:45.546774+00 |              | streaming | 0/56894278 | 0/56894278 |            |            | 00:00:05.270507 | 00:17:26.022868 | 00:17:26.022868 |             0 | async      | 1999-12-21 01:03:04.777727+00
 433 |    16471 | debezium | Debezium Streaming | 10.244.2.9  |                 |       55568 | 2025-10-05 21:24:45.547235+00 |              | streaming | 0/56894278 | 0/56894278 |            |            | 00:00:05.552816 | 00:17:26.000925 | 00:17:26.000925 |             0 | async      | 1999-12-21 01:03:04.778009+00
(4 rows)
[2025-10-05 17:42:22] [INFO] Creating backup of current credentials...
[2025-10-05 17:42:23] [INFO] Starting PostgreSQL CDC user credential rotation...
[2025-10-05 17:42:23] [INFO] Current CDC user: debezium
[2025-10-05 17:42:23] [INFO] Creating new CDC user: debezium_20251005_174223
[2025-10-05 17:42:24] [DEBUG] SELECT * FROM pg_replication_slots; 
          slot_name         |  plugin  | slot_type | datoid | database  | temporary | active | active_pid | xmin | catalog_xmin | restart_lsn | confirmed_flush_lsn | wal_status | safe_wal_size | two_phase 
---------------------------+----------+-----------+--------+-----------+-----------+--------+------------+------+--------------+-------------+---------------------+------------+---------------+-----------
 debezium_slot_products    | pgoutput | logical   |  16384 | ecommerce | f         | t      |        433 |      |        15919 | 0/55A27648  | 0/55A27648          | reserved   |    4285966760 | f
 debezium_slot_orders      | pgoutput | logical   |  16384 | ecommerce | f         | t      |        430 |      |        15919 | 0/55A27648  | 0/55A27648          | reserved   |    4285966760 | f
 debezium_slot_order_items | pgoutput | logical   |  16384 | ecommerce | f         | t      |        432 |      |        15919 | 0/55A27648  | 0/55A27648          | reserved   |    4285966760 | f
 debezium_slot_users       | pgoutput | logical   |  16384 | ecommerce | f         | t      |        757 |      |        16594 | 0/56894158  | 0/56894158          | reserved   |    4302743976 | f
(4 rows)
[2025-10-05 17:42:24] [DEBUG] SELECT * FROM pg_roles WHERE rolname like 'debezium%' OR rolname like 'postgres%'; 
          rolname          | rolsuper | rolinherit | rolcreaterole | rolcreatedb | rolcanlogin | rolreplication | rolconnlimit | rolpassword | rolvaliduntil | rolbypassrls |       rolconfig        |  oid  
--------------------------+----------+------------+---------------+-------------+-------------+----------------+--------------+-------------+---------------+--------------+------------------------+-------
 postgres                 | t        | t          | t             | t           | t           | t              |           -1 | ********    |               | t            |                        |    10
 debezium_parent          | f        | t          | f             | f           | f           | t              |           -1 | ********    |               | f            |                        | 16457
 debezium                 | f        | t          | f             | f           | t           | t              |           -1 | ********    |               | f            | {role=debezium_parent} | 16471
 debezium_20251005_174223 | f        | t          | f             | f           | t           | t              |           -1 | ********    |               | f            | {role=debezium_parent} | 16494
(4 rows)
[2025-10-05 17:42:24] [DEBUG] SELECT * FROM pg_stat_replication; 
  pid | usesysid | usename  |  application_name  | client_addr | client_hostname | client_port |         backend_start         | backend_xmin |   state   |  sent_lsn  | write_lsn  | flush_lsn  | replay_lsn |    write_lag    |    flush_lag    |   replay_lag    | sync_priority | sync_state |          reply_time           
-----+----------+----------+--------------------+-------------+-----------------+-------------+-------------------------------+--------------+-----------+------------+------------+------------+------------+-----------------+-----------------+-----------------+---------------+------------+-------------------------------
 757 |    16471 | debezium | Debezium Streaming | 10.244.2.9  |                 |       53482 | 2025-10-05 21:26:58.533343+00 |              | streaming | 0/56895658 | 0/56894278 | 0/56894158 | 0/56894158 | 00:00:07.549937 | 00:00:27.636706 | 00:00:27.636706 |             0 | async      | 1999-12-21 01:03:04.780007+00
 430 |    16471 | debezium | Debezium Streaming | 10.244.2.9  |                 |       55534 | 2025-10-05 21:24:45.545888+00 |              | streaming | 0/56895658 | 0/56894278 |            |            | 00:00:05.544385 | 00:17:25.973049 | 00:17:25.973049 |             0 | async      | 1999-12-21 01:03:04.778002+00
 432 |    16471 | debezium | Debezium Streaming | 10.244.2.9  |                 |       55530 | 2025-10-05 21:24:45.546774+00 |              | streaming | 0/56895658 | 0/56894278 |            |            | 00:00:05.270507 | 00:17:26.022868 | 00:17:26.022868 |             0 | async      | 1999-12-21 01:03:04.777727+00
 433 |    16471 | debezium | Debezium Streaming | 10.244.2.9  |                 |       55568 | 2025-10-05 21:24:45.547235+00 |              | streaming | 0/56895658 | 0/56894278 |            |            | 00:00:05.552816 | 00:17:26.000925 | 00:17:26.000925 |             0 | async      | 1999-12-21 01:03:04.778009+00
(4 rows)
[2025-10-05 17:42:24] [INFO] Pausing Debezium connectors...
[2025-10-05 17:42:30] [INFO] Validating new user has proper replication permissions...
[2025-10-05 17:42:30] [INFO] New user has proper replication permissions - can use existing slot
[2025-10-05 17:42:30] [INFO] Updating Kubernetes secret with new credentials...
[2025-10-05 17:42:30] [INFO] Deleting Kafka Connect pod to force restart...
[2025-10-05 17:43:44] [INFO] Resuming Debezium connectors after 20s ...
[2025-10-05 17:44:11] [DEBUG] SELECT * FROM pg_replication_slots; 
          slot_name         |  plugin  | slot_type | datoid | database  | temporary | active | active_pid | xmin | catalog_xmin | restart_lsn | confirmed_flush_lsn | wal_status | safe_wal_size | two_phase 
---------------------------+----------+-----------+--------+-----------+-----------+--------+------------+------+--------------+-------------+---------------------+------------+---------------+-----------
 debezium_slot_products    | pgoutput | logical   |  16384 | ecommerce | f         | t      |       3241 |      |        15919 | 0/55A27648  | 0/55A27648          | reserved   |    4285966760 | f
 debezium_slot_orders      | pgoutput | logical   |  16384 | ecommerce | f         | t      |       3242 |      |        15919 | 0/55A27648  | 0/55A27648          | reserved   |    4285966760 | f
 debezium_slot_order_items | pgoutput | logical   |  16384 | ecommerce | f         | t      |       3244 |      |        15919 | 0/55A27648  | 0/55A27648          | reserved   |    4285966760 | f
 debezium_slot_users       | pgoutput | logical   |  16384 | ecommerce | f         | t      |       3243 |      |        16594 | 0/56894158  | 0/56894158          | reserved   |    4302743976 | f
(4 rows)
[2025-10-05 17:44:11] [DEBUG] SELECT * FROM pg_roles WHERE rolname like 'debezium%' OR rolname like 'postgres%'; 
          rolname          | rolsuper | rolinherit | rolcreaterole | rolcreatedb | rolcanlogin | rolreplication | rolconnlimit | rolpassword | rolvaliduntil | rolbypassrls |       rolconfig        |  oid  
--------------------------+----------+------------+---------------+-------------+-------------+----------------+--------------+-------------+---------------+--------------+------------------------+-------
 postgres                 | t        | t          | t             | t           | t           | t              |           -1 | ********    |               | t            |                        |    10
 debezium_parent          | f        | t          | f             | f           | f           | t              |           -1 | ********    |               | f            |                        | 16457
 debezium                 | f        | t          | f             | f           | t           | t              |           -1 | ********    |               | f            | {role=debezium_parent} | 16471
 debezium_20251005_174223 | f        | t          | f             | f           | t           | t              |           -1 | ********    |               | f            | {role=debezium_parent} | 16494
(4 rows)
[2025-10-05 17:44:11] [DEBUG] SELECT * FROM pg_stat_replication; 
  pid  | usesysid |         usename          |  application_name  | client_addr | client_hostname | client_port |         backend_start         | backend_xmin |   state   |  sent_lsn  | write_lsn  | flush_lsn | replay_lsn |    write_lag    |    flush_lag    |   replay_lag    | sync_priority | sync_state |          reply_time           
------+----------+--------------------------+--------------------+-------------+-----------------+-------------+-------------------------------+--------------+-----------+------------+------------+-----------+------------+-----------------+-----------------+-----------------+---------------+------------+-------------------------------
 3241 |    16494 | debezium_20251005_174223 | Debezium Streaming | 10.244.2.10 |                 |       36038 | 2025-10-05 21:44:06.098768+00 |              | streaming | 0/56895658 | 0/55A27648 |           |            | 00:00:00.010793 | 00:00:00.010793 | 00:00:00.010793 |             0 | async      | 1999-12-21 01:03:04.887672+00
 3242 |    16494 | debezium_20251005_174223 | Debezium Streaming | 10.244.2.10 |                 |       36020 | 2025-10-05 21:44:06.099144+00 |              | streaming | 0/56895658 | 0/55A27648 |           |            | 00:00:00.010922 | 00:00:00.010922 | 00:00:00.010922 |             0 | async      | 1999-12-21 01:03:04.887672+00
 3243 |    16494 | debezium_20251005_174223 | Debezium Streaming | 10.244.2.10 |                 |       36024 | 2025-10-05 21:44:06.09963+00  |              | streaming | 0/56895658 | 0/56894158 |           |            | 00:00:00.012444 | 00:00:00.012444 | 00:00:00.012444 |             0 | async      | 1999-12-21 01:03:04.887672+00
 3244 |    16494 | debezium_20251005_174223 | Debezium Streaming | 10.244.2.10 |                 |       36022 | 2025-10-05 21:44:06.100049+00 |              | streaming | 0/56895658 | 0/55A27648 |           |            | 00:00:00.011168 | 00:00:00.011168 | 00:00:00.011168 |             0 | async      | 1999-12-21 01:03:04.887674+00
(4 rows)
[2025-10-05 17:44:11] [INFO] Validating replication slot activity and new user connection...
[2025-10-05 17:44:27] [INFO] New user 'debezium_20251005_174223' is successfully connected for replication
[2025-10-05 17:44:27] [INFO] Validating CDC functionality...
[2025-10-05 17:44:28] [INFO] CDC is successfully processing changes after rotation
[2025-10-05 17:44:28] [INFO] Old user 'debezium' should be cleaned up after validation period
[2025-10-05 17:44:28] [INFO] To clean up old user after validation, run:
[2025-10-05 17:44:28] [INFO] kubectl --context "kind-data-ingestion" exec -n data-ingestion postgresql-0 -- psql -U postgres -d ecommerce -c "DROP USER IF EXISTS debezium;"
[2025-10-05 17:44:28] [SUCCESS] PostgreSQL CDC user rotation completed successfully
[2025-10-05 17:44:28] [INFO] Starting Kafka Connect service account credential rotation...
[2025-10-05 17:44:28] [INFO] Kafka Connect service account rotation completed (using PostgreSQL credential rotation)
[2025-10-05 17:44:28] [INFO] Starting Schema Registry credential rotation...
[2025-10-05 17:44:28] [DEBUG] SELECT * FROM pg_replication_slots; 
          slot_name         |  plugin  | slot_type | datoid | database  | temporary | active | active_pid | xmin | catalog_xmin | restart_lsn | confirmed_flush_lsn | wal_status | safe_wal_size | two_phase 
---------------------------+----------+-----------+--------+-----------+-----------+--------+------------+------+--------------+-------------+---------------------+------------+---------------+-----------
 debezium_slot_products    | pgoutput | logical   |  16384 | ecommerce | f         | t      |       3241 |      |        15919 | 0/55A27648  | 0/55A27648          | reserved   |    4285966760 | f
 debezium_slot_orders      | pgoutput | logical   |  16384 | ecommerce | f         | t      |       3242 |      |        15919 | 0/55A27648  | 0/55A27648          | reserved   |    4285966760 | f
 debezium_slot_order_items | pgoutput | logical   |  16384 | ecommerce | f         | t      |       3244 |      |        15919 | 0/55A27648  | 0/55A27648          | reserved   |    4285966760 | f
 debezium_slot_users       | pgoutput | logical   |  16384 | ecommerce | f         | t      |       3243 |      |        16594 | 0/56894158  | 0/56894158          | reserved   |    4302743976 | f
(4 rows)
[2025-10-05 17:44:29] [DEBUG] SELECT * FROM pg_roles WHERE rolname like 'debezium%' OR rolname like 'postgres%'; 
          rolname          | rolsuper | rolinherit | rolcreaterole | rolcreatedb | rolcanlogin | rolreplication | rolconnlimit | rolpassword | rolvaliduntil | rolbypassrls |       rolconfig        |  oid  
--------------------------+----------+------------+---------------+-------------+-------------+----------------+--------------+-------------+---------------+--------------+------------------------+-------
 postgres                 | t        | t          | t             | t           | t           | t              |           -1 | ********    |               | t            |                        |    10
 debezium_parent          | f        | t          | f             | f           | f           | t              |           -1 | ********    |               | f            |                        | 16457
 debezium                 | f        | t          | f             | f           | t           | t              |           -1 | ********    |               | f            | {role=debezium_parent} | 16471
 debezium_20251005_174223 | f        | t          | f             | f           | t           | t              |           -1 | ********    |               | f            | {role=debezium_parent} | 16494
(4 rows)
[2025-10-05 17:44:29] [DEBUG] SELECT * FROM pg_stat_replication; 
  pid  | usesysid |         usename          |  application_name  | client_addr | client_hostname | client_port |         backend_start         | backend_xmin |   state   |  sent_lsn  | write_lsn  | flush_lsn | replay_lsn |    write_lag    |    flush_lag    |   replay_lag    | sync_priority | sync_state |          reply_time           
------+----------+--------------------------+--------------------+-------------+-----------------+-------------+-------------------------------+--------------+-----------+------------+------------+-----------+------------+-----------------+-----------------+-----------------+---------------+------------+-------------------------------
 3241 |    16494 | debezium_20251005_174223 | Debezium Streaming | 10.244.2.10 |                 |       36038 | 2025-10-05 21:44:06.098768+00 |              | streaming | 0/56895658 | 0/56895658 |           |            | 00:00:10.008009 | 00:00:20.00807  | 00:00:20.00807  |             0 | async      | 1999-12-21 01:03:04.907673+00
 3242 |    16494 | debezium_20251005_174223 | Debezium Streaming | 10.244.2.10 |                 |       36020 | 2025-10-05 21:44:06.099144+00 |              | streaming | 0/56895658 | 0/56895658 |           |            | 00:00:10.008101 | 00:00:20.008138 | 00:00:20.008138 |             0 | async      | 1999-12-21 01:03:04.907673+00
 3243 |    16494 | debezium_20251005_174223 | Debezium Streaming | 10.244.2.10 |                 |       36024 | 2025-10-05 21:44:06.09963+00  |              | streaming | 0/56895658 | 0/56895658 |           |            | 00:00:10.009595 | 00:00:20.009651 | 00:00:20.009651 |             0 | async      | 1999-12-21 01:03:04.907673+00
 3244 |    16494 | debezium_20251005_174223 | Debezium Streaming | 10.244.2.10 |                 |       36022 | 2025-10-05 21:44:06.100049+00 |              | streaming | 0/56895658 | 0/56895658 |           |            | 00:00:10.007398 | 00:00:20.007466 | 00:00:20.007466 |             0 | async      | 1999-12-21 01:03:04.907672+00
(4 rows)
[2025-10-05 17:44:29] [INFO] Pausing Debezium connectors...
[2025-10-05 17:44:35] [INFO] Updating Schema Registry credentials in Kubernetes secret...
[2025-10-05 17:44:35] [INFO] Deleting Schema Registry pod to force restart...
[2025-10-05 17:45:37] [INFO] Deleting Kafka Connect pod to use new Schema Registry credentials...
[2025-10-05 17:46:50] [INFO] Resuming Debezium connectors after 20s ...
[2025-10-05 17:47:17] [DEBUG] SELECT * FROM pg_replication_slots; 
          slot_name         |  plugin  | slot_type | datoid | database  | temporary | active | active_pid | xmin | catalog_xmin | restart_lsn | confirmed_flush_lsn | wal_status | safe_wal_size | two_phase 
---------------------------+----------+-----------+--------+-----------+-----------+--------+------------+------+--------------+-------------+---------------------+------------+---------------+-----------
 debezium_slot_products    | pgoutput | logical   |  16384 | ecommerce | f         | t      |       3725 |      |        15919 | 0/55A27648  | 0/55A27648          | reserved   |    4285966528 | f
 debezium_slot_orders      | pgoutput | logical   |  16384 | ecommerce | f         | t      |       3727 |      |        15919 | 0/55A27648  | 0/55A27648          | reserved   |    4285966528 | f
 debezium_slot_order_items | pgoutput | logical   |  16384 | ecommerce | f         | t      |       3730 |      |        15919 | 0/55A27648  | 0/55A27648          | reserved   |    4285966528 | f
 debezium_slot_users       | pgoutput | logical   |  16384 | ecommerce | f         | t      |       3726 |      |        16594 | 0/56894158  | 0/56894158          | reserved   |    4302743744 | f
(4 rows)
[2025-10-05 17:47:17] [DEBUG] SELECT * FROM pg_roles WHERE rolname like 'debezium%' OR rolname like 'postgres%'; 
          rolname          | rolsuper | rolinherit | rolcreaterole | rolcreatedb | rolcanlogin | rolreplication | rolconnlimit | rolpassword | rolvaliduntil | rolbypassrls |       rolconfig        |  oid  
--------------------------+----------+------------+---------------+-------------+-------------+----------------+--------------+-------------+---------------+--------------+------------------------+-------
 postgres                 | t        | t          | t             | t           | t           | t              |           -1 | ********    |               | t            |                        |    10
 debezium_parent          | f        | t          | f             | f           | f           | t              |           -1 | ********    |               | f            |                        | 16457
 debezium                 | f        | t          | f             | f           | t           | t              |           -1 | ********    |               | f            | {role=debezium_parent} | 16471
 debezium_20251005_174223 | f        | t          | f             | f           | t           | t              |           -1 | ********    |               | f            | {role=debezium_parent} | 16494
(4 rows)
[2025-10-05 17:47:17] [DEBUG] SELECT * FROM pg_stat_replication; 
  pid  | usesysid |         usename          |  application_name  | client_addr | client_hostname | client_port |         backend_start         | backend_xmin |   state   |  sent_lsn  | write_lsn  | flush_lsn | replay_lsn |    write_lag    |    flush_lag    |   replay_lag    | sync_priority | sync_state |          reply_time           
------+----------+--------------------------+--------------------+-------------+-----------------+-------------+-------------------------------+--------------+-----------+------------+------------+-----------+------------+-----------------+-----------------+-----------------+---------------+------------+-------------------------------
 3725 |    16494 | debezium_20251005_174223 | Debezium Streaming | 10.244.2.11 |                 |       56228 | 2025-10-05 21:47:11.970527+00 |              | streaming | 0/56895740 | 0/55A27648 |           |            | 00:00:00.002865 | 00:00:00.002865 | 00:00:00.002865 |             0 | async      | 1999-12-21 01:03:05.073541+00
 3726 |    16494 | debezium_20251005_174223 | Debezium Streaming | 10.244.2.11 |                 |       56230 | 2025-10-05 21:47:11.970985+00 |              | streaming | 0/56895740 | 0/56894158 |           |            | 00:00:00.015392 | 00:00:00.015392 | 00:00:00.015392 |             0 | async      | 1999-12-21 01:03:05.073546+00
 3727 |    16494 | debezium_20251005_174223 | Debezium Streaming | 10.244.2.11 |                 |       56226 | 2025-10-05 21:47:11.971477+00 |              | streaming | 0/56895740 | 0/55A27648 |           |            | 00:00:00.002826 | 00:00:00.002826 | 00:00:00.002826 |             0 | async      | 1999-12-21 01:03:05.073542+00
 3730 |    16494 | debezium_20251005_174223 | Debezium Streaming | 10.244.2.11 |                 |       56270 | 2025-10-05 21:47:12.032063+00 |              | streaming | 0/56895740 | 0/55A27648 |           |            | 00:00:00.09222  | 00:00:00.09222  | 00:00:00.09222  |             0 | async      | 1999-12-21 01:03:05.073595+00
(4 rows)
[2025-10-05 17:47:17] [SUCCESS] Schema Registry credential rotation completed successfully
[2025-10-05 17:47:17] [INFO] Running end-to-end validation...
[2025-10-05 17:47:18] [INFO] Testing end-to-end data flow in 20s ...
[2025-10-05 17:47:38] [DEBUG] SELECT * FROM pg_replication_slots; 
          slot_name         |  plugin  | slot_type | datoid | database  | temporary | active | active_pid | xmin | catalog_xmin | restart_lsn | confirmed_flush_lsn | wal_status | safe_wal_size | two_phase 
---------------------------+----------+-----------+--------+-----------+-----------+--------+------------+------+--------------+-------------+---------------------+------------+---------------+-----------
 debezium_slot_products    | pgoutput | logical   |  16384 | ecommerce | f         | t      |       3725 |      |        15919 | 0/55A27648  | 0/55A27648          | reserved   |    4285958216 | f
 debezium_slot_orders      | pgoutput | logical   |  16384 | ecommerce | f         | t      |       3727 |      |        15919 | 0/55A27648  | 0/55A27648          | reserved   |    4285958216 | f
 debezium_slot_order_items | pgoutput | logical   |  16384 | ecommerce | f         | t      |       3730 |      |        15919 | 0/55A27648  | 0/55A27648          | reserved   |    4285958216 | f
 debezium_slot_users       | pgoutput | logical   |  16384 | ecommerce | f         | t      |       3726 |      |        16594 | 0/56894158  | 0/56894158          | reserved   |    4302735432 | f
(4 rows)
[2025-10-05 17:47:39] [DEBUG] SELECT * FROM pg_roles WHERE rolname like 'debezium%' OR rolname like 'postgres%'; 
          rolname          | rolsuper | rolinherit | rolcreaterole | rolcreatedb | rolcanlogin | rolreplication | rolconnlimit | rolpassword | rolvaliduntil | rolbypassrls |       rolconfig        |  oid  
--------------------------+----------+------------+---------------+-------------+-------------+----------------+--------------+-------------+---------------+--------------+------------------------+-------
 postgres                 | t        | t          | t             | t           | t           | t              |           -1 | ********    |               | t            |                        |    10
 debezium_parent          | f        | t          | f             | f           | f           | t              |           -1 | ********    |               | f            |                        | 16457
 debezium                 | f        | t          | f             | f           | t           | t              |           -1 | ********    |               | f            | {role=debezium_parent} | 16471
 debezium_20251005_174223 | f        | t          | f             | f           | t           | t              |           -1 | ********    |               | f            | {role=debezium_parent} | 16494
(4 rows)
[2025-10-05 17:47:39] [DEBUG] SELECT * FROM pg_stat_replication; 
  pid  | usesysid |         usename          |  application_name  | client_addr | client_hostname | client_port |         backend_start         | backend_xmin |   state   |  sent_lsn  | write_lsn  | flush_lsn | replay_lsn |    write_lag    |    flush_lag    |   replay_lag    | sync_priority | sync_state |          reply_time           
------+----------+--------------------------+--------------------+-------------+-----------------+-------------+-------------------------------+--------------+-----------+------------+------------+-----------+------------+-----------------+-----------------+-----------------+---------------+------------+-------------------------------
 3725 |    16494 | debezium_20251005_174223 | Debezium Streaming | 10.244.2.11 |                 |       56228 | 2025-10-05 21:47:11.970527+00 |              | streaming | 0/568977B8 | 0/568977B8 |           |            | 00:00:09.999138 | 00:00:19.999314 | 00:00:19.999314 |             0 | async      | 1999-12-21 01:03:05.093541+00
 3726 |    16494 | debezium_20251005_174223 | Debezium Streaming | 10.244.2.11 |                 |       56230 | 2025-10-05 21:47:11.970985+00 |              | streaming | 0/568977B8 | 0/568977B8 |           |            | 00:00:10.003218 | 00:00:20.003349 | 00:00:20.003349 |             0 | async      | 1999-12-21 01:03:05.093546+00
 3727 |    16494 | debezium_20251005_174223 | Debezium Streaming | 10.244.2.11 |                 |       56226 | 2025-10-05 21:47:11.971477+00 |              | streaming | 0/568977B8 | 0/568977B8 |           |            | 00:00:09.99982  | 00:00:19.999961 | 00:00:19.999961 |             0 | async      | 1999-12-21 01:03:05.093542+00
 3730 |    16494 | debezium_20251005_174223 | Debezium Streaming | 10.244.2.11 |                 |       56270 | 2025-10-05 21:47:12.032063+00 |              | streaming | 0/568977B8 | 0/568977B8 |           |            | 00:00:09.999547 | 00:00:19.999694 | 00:00:19.999694 |             0 | async      | 1999-12-21 01:03:05.093552+00
(4 rows)
[2025-10-05 17:47:39] [DEBUG] schema.registry.basic.auth.user.info=admin:XMbXvPACoWSfu0vOobbvZC3hn
[2025-10-05 17:47:39] [DEBUG] Waiting 6 seconds for kafka-avro-console-consumer to start...
[2025-10-05 17:47:45] [INFO] Waiting for CDC to process INSERT...
[2025-10-05 17:48:48] [INFO] CDC test passed
[2025-10-05 17:48:48] [SUCCESS] End-to-end validation completed successfully
[2025-10-05 17:48:48] [SUCCESS] Task 13 credential rotation completed successfully!
[2025-10-05 17:48:48] [INFO] Log file saved to: /e/Projects/DataPipe/1-data-ingestion-pipeline/../logs/data-ingestion/task13-logs/credential-rotation.log
[2025-10-05 17:48:48] [INFO] Remember to:
[2025-10-05 17:48:48] [INFO] 1. Monitor the pipeline for the next 24 hours
[2025-10-05 17:48:48] [INFO] 2. Clean up old PostgreSQL users after validation period
[2025-10-05 17:48:49] [INFO] 3. Remove credential backups after confirming stability
